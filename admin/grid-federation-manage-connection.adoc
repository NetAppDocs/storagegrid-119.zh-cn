---
permalink: admin/grid-federation-manage-connection.html 
sidebar: sidebar 
keywords: grid federation, edit connection, remove connection, rotate certificates 
summary: 管理StorageGRID系统之间的网格联合连接包括编辑连接详细信息、轮换证书、删除租户权限以及删除未使用的连接。 
---
= 管理电网联合连接
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
管理StorageGRID系统之间的网格联合连接包括编辑连接详细信息、轮换证书、删除租户权限以及删除未使用的连接。

.开始之前
* 您已使用link:../admin/web-browser-requirements.html["支持的网络浏览器"]。
* 你有link:admin-group-permissions.html["Root访问权限"]针对您登录的网格。




== [[edit_grid_fed_connection]]编辑电网联合连接

您可以通过登录到连接中任一网格上的主管理节点来编辑网格联合连接。对第一个网格进行更改后，您必须下载一个新的验证文件并将其上传到另一个网格。


NOTE: 在编辑连接时，帐户克隆或跨网格复制请求将继续使用现有的连接设置。您对第一个网格所做的任何编辑都会保存在本地，但只有在将其上传到第二个网格、保存并测试后才会使用。



=== 开始编辑连接

.步骤
. 从任一网格上的主管理节点Sign in到网格管理器。
. 选择 *NODES* 并确认系统中的所有其他管理节点都在线。
+

NOTE: 当您编辑网格联合连接时， StorageGRID会尝试在第一个网格上的所有管理节点上保存“候选配置”文件。如果该文件无法保存到所有管理节点，则当您选择*保存并测试*时会出现警告消息。

. 选择 *配置* > *系统* > *网格联合*。
. 使用网格联合页面或特定连接的详细信息页面上的*操作*菜单编辑连接详细信息。看link:grid-federation-create-connection.html["创建电网联合连接"]输入什么内容。
+
[role="tabbed-block"]
====
.操作菜单
--
.. 选择连接的单选按钮。
.. 选择*操作* > *编辑*。
.. 输入新信息。


--
.详细信息页面
--
.. 选择连接名称以显示其详细信息。
.. 选择*编辑*。
.. 输入新信息。


--
====
. 输入您登录的网格的配置密码。
. 选择*保存并继续*。
+
新值已保存，但直到您将新的验证文件上传到另一个网格后，它们才会应用于连接。

. 选择*下载验证文件*。
+
要稍后下载此文件，请转到连接的详细信息页面。

. 找到下载的文件(`_connection-name_.grid-federation`)，并将其保存到安全位置。
+

CAUTION: 验证文件包含秘密，必须安全存储和传输。

. 选择*关闭*返回网格联合页面。
. 确认*连接状态*为*待编辑*。
+

NOTE: 如果您开始编辑连接时连接状态不是*已连接*，则它将不会更改为*待编辑*。

. 提供 `_connection-name_.grid-federation`文件发送给另一个网格的网格管理员。




=== 完成编辑连接

通过在另一个网格上上传验证文件来完成连接编辑。

.步骤
. 从主管理节点Sign in到网格管理器。
. 选择 *配置* > *系统* > *网格联合*。
. 选择*上传验证文件*进入上传页面。
. 选择*上传验证文件*。然后，浏览并选择从第一个网格下载的文件。
. 输入您当前登录的网格的配置密码。
. 选择*保存并测试*。
+
如果可以使用编辑的值建立连接，则会显示成功消息。否则，会出现错误消息。查看消息并解决任何问题。

. 关闭向导以返回到网格联合页面。
. 确认*连接状态*为*已连接*。
. 转到第一个网格上的网格联合页面并刷新浏览器。确认*连接状态*现在为*已连接*。
. 建立连接后，安全删除验证文件的所有副本。




== [[test_grid_fed_connection]]测试电网联合连接

.步骤
. 从主管理节点Sign in到网格管理器。
. 选择 *配置* > *系统* > *网格联合*。
. 使用网格联合页面或特定连接的详细信息页面上的*操作*菜单测试连接。
+
[role="tabbed-block"]
====
.操作菜单
--
.. 选择连接的单选按钮。
.. 选择*操作* > *测试*。


--
.详细信息页面
--
.. 选择连接名称以显示其详细信息。
.. 选择*测试连接*。


--
====
. 查看连接状态：
+
[cols="1a,2a"]
|===
| 连接状态 | 描述 


 a| 
已连接
 a| 
两个电网均已连接并正常通信。



 a| 
错误
 a| 
连接处于错误状态。例如，证书已过期或配置值不再有效。



 a| 
待处理编辑
 a| 
您已编辑此网格上的连接，但该连接仍在使用现有配置。要完成编辑，请将新的验证文件上传到另一个网格。



 a| 
等待连接
 a| 
您已在此网格上配置了连接，但另一个网格上的连接尚未完成。从此网格下载验证文件并将其上传到另一个网格。



 a| 
未知
 a| 
连接处于未知状态，可能是由于网络问题或离线节点。

|===
. 如果连接状态为*错误*，请解决任何问题。然后，再次选择*测试连接*以确认问题已修复。




== [[rotate_grid_fed_certificates]]轮换连接证书

每个网格联合连接使用四个自动生成的 SSL 证书来保护连接。当每个网格的两个证书接近到期日期时，*网格联合证书到期*警报会提醒您轮换证书。


CAUTION: 如果连接两端的证书过期，连接将停止工作，并且复制将处于待处理状态，直到证书更新为止。

.步骤
. 从任一网格上的主管理节点Sign in到网格管理器。
. 选择 *配置* > *系统* > *网格联合*。
. 从网格联合页面上的任一选项卡中，选择连接名称以显示其详细信息。
. 选择“*证书*”选项卡。
. 选择*轮换证书*。
. 指定新证书的有效期。
. 输入您登录的网格的配置密码。
. 选择*轮换证书*。
. 根据需要，在连接中的另一个网格上重复这些步骤。
+
一般来说，连接两端的证书使用相同的天数。





== [[remove_grid_fed_connection]]删除电网联合连接

您可以从连接中的任一网格中删除网格联合连接。如图所示，您必须在两个网格上执行先决条件步骤，以确认任一网格上都没有任何租户使用该连接。

image::../media/grid-federation-remove-connection.png[删除电网联合连接的步骤]

删除连接之前，请注意以下事项：

* 删除连接不会删除网格之间已复制的任何项目。例如，当租户的权限被删除时，两个网格上都存在的租户用户、组和对象不会从任何一个网格中删除。如果要删除这些项目，则必须从两个网格中手动删除它们。
* 当您删除连接时，任何待复制的对象（已提取但尚未复制到其他网格）的复制都将永久失败。




=== 禁用所有租户存储桶的复制

.步骤
. 从任一网格开始，从主管理节点登录到网格管理器。
. 选择 *配置* > *系统* > *网格联合*。
. 选择连接名称以显示其详细信息。
. 在“允许的租户”选项卡上，确定是否有任何租户正在使用该连接。
. 如果列出了任何租户，指示所有租户link:../tenant/grid-federation-manage-cross-grid-replication.html["禁用跨网格复制"]连接中两个网格上的所有存储桶。
+

TIP: 如果任何租户存储桶启用了跨网格复制，则您无法删除*使用网格联合连接*权限。每个租户帐户必须禁用两个网格上其存储桶的跨网格复制。





=== 删除每个租户的权限

在所有租户存储桶的跨网格复制都被禁用后，从两个网格上的所有租户中删除“使用网格联合权限”。

.步骤
. 选择 *配置* > *系统* > *网格联合*。
. 选择连接名称以显示其详细信息。
. 对于“*允许的租户*”选项卡上的每个租户，从每个租户中删除“使用网格联合连接*”权限。看link:grid-federation-manage-tenants.html["管理获准租户"] 。
. 对另一个网格上允许的租户重复这些步骤。




=== 删除连接

.步骤
. 当任一网格上都没有租户使用该连接时，选择*删除*。
. 查看确认消息，然后选择*删除*。
+
** 如果可以删除连接，则会显示成功消息。电网联合连接现已从两个电网中删除。
** 如果无法删除连接（例如，它仍在使用中或存在连接错误），则会显示错误消息。您可以执行以下任一操作：
+
*** 解决错误（推荐）。看link:grid-federation-troubleshoot.html["解决网格联合错误"] 。
*** 强制断开连接。请参阅下一部分。








== [[force-remove_grid_fed_connection]]强制删除电网联合连接

如果有必要，您可以强制删除没有*已连接*状态的连接。

强制删除只会从本地电网中删除连接。要完全删除连接，请对两个网格执行相同的步骤。

.步骤
. 从确认对话框中，选择*强制删除*。
+
出现成功消息。此电网联合连接无法再使用。但是，租户存储桶可能仍然启用跨网格复制，并且某些对象副本可能已经在连接中的网格之间复制。

. 从连接中的另一个网格，从主管理节点登录到网格管理器。
. 选择 *配置* > *系统* > *网格联合*。
. 选择连接名称以显示其详细信息。
. 选择*删除*和*是*。
. 选择“强制删除”以从该网格中删除连接。

