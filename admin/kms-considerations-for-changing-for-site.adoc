---
permalink: admin/kms-considerations-for-changing-for-site.html 
sidebar: sidebar 
keywords: kms cluster, copy kms encryption key 
summary: 每个密钥管理服务器（KMS）或 KMS 集群为单个站点或一组站点的所有设备节点提供加密密钥。如果您需要更改站点使用的 KMS，则可能需要将加密密钥从一个 KMS 复制到另一个 KMS。 
---
= 更改站点 KMS 的注意事项
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
每个密钥管理服务器 (KMS) 或 KMS 群集向单个站点或一组站点的所有设备节点提供加密密钥。如果您需要更改站点使用的 KMS，则可能需要将加密密钥从一个 KMS 复制到另一个 KMS。

如果您更改站点使用的 KMS，则必须确保该站点上先前加密的设备节点可以使用存储在新 KMS 上的密钥解密。在某些情况下，您可能需要将当前版本的加密密钥从原始 KMS 复制到新的 KMS。您必须确保 KMS 具有正确的密钥来解密站点上的加密设备节点。

例如：

. 您最初配置一个适用于所有没有专用 KMS 的站点的默认 KMS。
. 保存 KMS 后，所有启用了 *节点加密* 设置的设备节点都会连接到 KMS 并请求加密密钥。此密钥用于加密所有站点的设备节点。还必须使用相同的密钥来解密这些设备。
+
image::../media/kms_default_key.png[KMS 默认密钥]

. 您决定为一个站点（图中的数据中心 3）添加特定于站点的 KMS。但是，由于设备节点已经加密，因此当您尝试保存站点特定 KMS 的配置时会发生验证错误。发生该错误的原因是站点特定的 KMS 没有正确的密钥来解密该站点的节点。
+
image::../media/kms_wrong_key.png[KMS 密钥错误]

. 为了解决这个问题，您可以将当前版本的加密密钥从默认 KMS 复制到新的 KMS。 （从技术上讲，您将原始密钥复制到具有相同别名的新密钥。原始密钥将成为新密钥的先前版本。）站点特定的 KMS 现在具有解密数据中心 3 的设备节点的正确密钥，因此可以将其保存在StorageGRID中。
+
image::../media/kms_copied_key.png[KMS 复制密钥]





== 更改站点所用 KMS 的用例

该表总结了更改站点 KMS 的最常见情况所需的步骤。

[cols="1a,2a"]
|===
| 更改站点 KMS 的用例 | 必需步骤 


 a| 
您有一个或多个特定于站点的 KMS 条目，并且想要使用其中一个作为默认 KMS。
 a| 
编辑特定于站点的 KMS。在“管理密钥”字段中，选择“未由其他 KMS 管理的站点（默认 KMS）”。站点特定的 KMS 现在将用作默认 KMS。它将适用于任何没有专用 KMS 的站点。

link:kms-editing.html["编辑密钥管理服务器 (KMS)"]



 a| 
您有一个默认的 KMS，并且在扩展中添加了一个新站点。您不想对新站点使用默认的 KMS。
 a| 
. 如果新站点的设备节点已由默认 KMS 加密，请使用 KMS 软件将当前版本的加密密钥从默认 KMS 复制到新的 KMS。
. 使用网格管理器添加新的 KMS 并选择站点。


link:kms-adding.html["添加密钥管理服务器 (KMS)"]



 a| 
您希望站点的 KMS 使用不同的服务器。
 a| 
. 如果站点上的设备节点已被现有 KMS 加密，请使用 KMS 软件将当前版本的加密密钥从现有 KMS 复制到新的 KMS。
. 使用网格管理器，编辑现有的 KMS 配置并输入新的主机名或 IP 地址。


link:kms-adding.html["添加密钥管理服务器 (KMS)"]

|===