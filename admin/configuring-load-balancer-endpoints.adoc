---
permalink: admin/configuring-load-balancer-endpoints.html 
sidebar: sidebar 
keywords: how to configure load balancer endpoint, how to attach certificate to load balancer endpoint 
summary: 负载均衡器端点决定 S3 客户端在连接到网关和管理节点上的StorageGRID负载均衡器时可以使用的端口和网络协议。您还可以使用端点访问网格管理器、租户管理器或两者。 
---
= 配置负载均衡器端点
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
负载均衡器端点决定 S3 客户端在连接到网关和管理节点上的StorageGRID负载均衡器时可以使用的端口和网络协议。您还可以使用端点访问网格管理器、租户管理器或两者。


TIP: 此版本的文档站点已删除 Swift 详细信息。看 https://docs.netapp.com/us-en/storagegrid-118/admin/configuring-client-connections.html["配置 S3 和 Swift 客户端连接"^]。

.开始之前
* 您已使用link:../admin/web-browser-requirements.html["支持的网络浏览器"]。
* 你有link:admin-group-permissions.html["Root访问权限"]。
* 您已审阅link:managing-load-balancing.html["负载平衡的注意事项"]。
* 如果您之前重新映射了要用于负载均衡器端点的端口，则您必须link:../maintain/removing-port-remaps.html["删除了端口重新映射"]。
* 您已创建计划使用的任何高可用性 (HA) 组。建议使用 HA 组，但这不是必需的。看link:managing-high-availability-groups.html["管理高可用性组"] 。
* 如果负载均衡器端点将由link:../admin/manage-s3-select-for-tenant-accounts.html["S3 Select 的 S3 租户"]，它不能使用任何裸机节点的 IP 地址或 FQDN。仅允许服务设备和基于 VMware 的软件节点作为用于 S3 Select 的负载均衡器端点。
* 您已配置计划使用的所有 VLAN 接口。看link:configure-vlan-interfaces.html["配置VLAN接口"] 。
* 如果您正在创建 HTTPS 端点（推荐），则您拥有服务器证书的信息。
+

NOTE: 对端点证书的更改最多可能需要 15 分钟才能应用到所有节点。

+
** 要上传证书，您需要服务器证书、证书私钥以及可选的 CA 包。
** 要生成证书，您需要 S3 客户端将用于访问端点的所有域名和 IP 地址。您还必须知道主题（专有名称）。
** 如果您想使用StorageGRID S3 API 证书（也可用于直接连接到存储节点），您已经用外部证书颁发机构签名的自定义证书替换了默认证书。看link:../admin/configuring-custom-server-certificate-for-storage-node.html["配置 S3 API 证书"] 。






== 创建负载均衡器端点

每个 S3 客户端负载均衡器端点指定一个端口、一个客户端类型（S3）和一个网络协议（HTTP 或 HTTPS）。管理接口负载均衡器端点指定端口、接口类型和不受信任的客户端网络。



=== 访问向导

.步骤
. 选择 *配置* > *网络* > *负载均衡器端点*。
. 要为 S3 或 Swift 客户端创建端点，请选择 *S3 或 Swift 客户端* 选项卡。
. 要创建用于访问网格管理器、租户管理器或两者的端点，请选择“管理界面”选项卡。
. 选择“*创建*”。




=== 输入端点详细信息

.步骤
. 选择适当的说明来输入您想要创建的端点类型的详细信息。


[role="tabbed-block"]
====
.S3 或 Swift 客户端
--
[cols="1a,3a"]
|===
| 字段 | 描述 


 a| 
名称
 a| 
端点的描述性名称，将显示在负载均衡器端点页面的表中。



 a| 
端口
 a| 
您想要用于负载平衡的StorageGRID端口。对于您创建的第一个端点，此字段默认为 10433，但您可以输入从 1 到 65535 的任何未使用的外部端口。

如果您输入 *80* 或 *8443*，则端点仅在网关节点上配置，除非您释放了端口 8443。然后，您可以使用端口 8443 作为 S3 端点，并且该端口将在网关和管理节点上进行配置。



 a| 
客户端类型
 a| 
将使用此端点的客户端应用程序的类型，*S3* 或 *Swift*。



 a| 
网络协议
 a| 
客户端连接到此端点时将使用的网络协议。

* 选择 *HTTPS* 进行安全的 TLS 加密通信（推荐）。您必须先附加安全证书，然后才能保存端点。
* 选择 *HTTP* 进行安全性较低、未加密的通信。仅对非生产网格使用 HTTP。


|===
--
.管理界面
--
[cols="1a,3a"]
|===
| 字段 | 描述 


 a| 
名称
 a| 
端点的描述性名称，将显示在负载均衡器端点页面的表中。



 a| 
端口
 a| 
您要用于访问网格管理器、租户管理器或两者的StorageGRID端口。

* 电网经理：*8443*
* 租户经理：*9443*
* 网格经理和租户经理：*443*


*注意*：您可以使用这些预设端口或其他可用端口。



 a| 
接口类型
 a| 
选择您将使用此端点访问的StorageGRID接口的单选按钮。



 a| 
不受信任的客户端网络
 a| 
如果此端点可供不受信任的客户端网络访问，请选择“是”。否则，选择“否”。

当您选择“是”时，该端口在所有不受信任的客户端网络上均处于打开状态。

*注意*：创建负载均衡器端点时，您只能将端口配置为对不受信任的客户端网络开放或关闭。

|===
--
====
. 选择*继续*。




=== 选择绑定模式

.步骤
. 选择端点的绑定模式来控制如何使用任意 IP 地址或使用特定 IP 地址和网络接口访问端点。
+
某些绑定模式适用于客户端端点或管理接口端点。两种端点类型的所有模式均列于此处。

+
[cols="1a,3a"]
|===
| 模式 | 描述 


 a| 
全局（客户端端点的默认设置）
 a| 
客户端可以使用任何网关节点或管理节点的 IP 地址、任何网络上任何 HA 组的虚拟 IP (VIP) 地址或相应的 FQDN 访问端点。

除非您需要限制此端点的可访问性，否则请使用*全局*设置。



 a| 
HA 组的虚拟 IP
 a| 
客户端必须使用 HA 组的虚拟 IP 地址（或相应的 FQDN）来访问此端点。

具有此绑定模式的端点都可以使用相同的端口号，只要您为端点选择的 HA 组不重叠。



 a| 
节点接口
 a| 
客户端必须使用选定节点接口的 IP 地址（或相应的 FQDN）来访问此端点。



 a| 
节点类型（仅限客户端端点）
 a| 
根据您选择的节点类型，客户端必须使用任何管理节点的 IP 地址（或相应的 FQDN）或任何网关节点的 IP 地址（或相应的 FQDN）来访问此端点。



 a| 
所有管理节点（管理接口端点的默认设置）
 a| 
客户端必须使用任何管理节点的 IP 地址（或相应的 FQDN）来访问此端点。

|===
+
如果多个端点使用相同的端口， StorageGRID将使用此优先级顺序来决定使用哪个端点：*HA 组的虚拟 IP* > *节点接口* > *节点类型* > *全局*。

+
如果您正在创建管理接口端点，则只允许管理节点。

. 如果您选择了*HA 组的虚拟 IP*，请选择一个或多个 HA 组。
+
如果您正在创建管理接口端点，请选择仅与管理节点关联的 VIP。

. 如果您选择了*节点接口*，请为要与此端点关联的每个管理节点或网关节点选择一个或多个节点接口。
. 如果您选择了*节点类型*，请选择管理节点（包括主管理节点和任何非主管理节点）或网关节点。




=== 控制租户访问


NOTE: 管理接口端点仅当端点具有<<enter-endpoint-details,租户管理器的接口类型>>。

.步骤
. 对于“租户访问”步骤，选择以下选项之一：
+
[cols="1a,2a"]
|===
| 字段 | 描述 


 a| 
允许所有租户（默认）
 a| 
所有租户帐户都可以使用此端点访问他们的存储桶。

如果您尚未创建任何租户帐户，则必须选择此选项。添加租户帐户后，您可以编辑负载均衡器端点以允许或阻止特定帐户。



 a| 
允许选定的租户
 a| 
只有选定的租户帐户可以使用此端点访问其存储桶。



 a| 
阻止选定的租户
 a| 
选定的租户帐户不能使用此端点访问其存储桶。所有其他租户都可以使用此端点。

|===
. 如果您正在创建 *HTTP* 端点，则无需附加证书。选择“*创建*”以添加新的负载均衡器端点。然后，转到<<after-you-finish,完成后>>。否则，选择“*继续*”以附加证书。




=== 附上证书

.步骤
. 如果您正在创建 *HTTPS* 端点，请选择要附加到该端点的安全证书类型。
+
该证书保护 S3 客户端与管理节点或网关节点上的负载均衡器服务之间的连接。

+
** *上传证书*。如果您有自定义证书需要上传，请选择此选项。
** *生成证书*。如果您拥有生成自定义证书所需的值，请选择此选项。
** *使用StorageGRID S3 证书*。如果您想使用全局 S3 API 证书，请选择此选项，该证书也可用于直接连接到存储节点。
+
除非您已将由网格 CA 签名的默认 S3 API 证书替换为由外部证书颁发机构签名的自定义证书，否则您无法选择此选项。看link:../admin/configuring-custom-server-certificate-for-storage-node.html["配置 S3 API 证书"] 。

** *使用管理接口证书*。如果您想使用全局管理接口证书，请选择此选项，该证书也可用于直接连接到管理节点。


. 如果您不使用StorageGRID S3 证书，请上传或生成该证书。
+
[role="tabbed-block"]
====
.上传证书
--
.. 选择*上传证书*。
.. 上传所需的服务器证书文件：
+
*** *服务器证书*：PEM编码的自定义服务器证书文件。
*** *证书私钥*：自定义服务器证书私钥文件(`.key`）。
+

NOTE: EC 私钥必须为 224 位或更大。  RSA 私钥必须为 2048 位或更大。

*** *CA 包*：一个可选文件，包含来自每个中间颁发证书机构 (CA) 的证书。该文件应包含每个 PEM 编码的 CA 证书文件，按证书链顺序连接。


.. 展开*证书详细信息*以查看您上传的每个证书的元数据。如果您上传了可选的 CA 包，则每个证书都会显示在其自己的选项卡上。
+
*** 选择*下载证书*保存证书文件或选择*下载 CA 包*保存证书包。
+
指定证书文件名和下载位置。使用扩展名保存文件 `.pem`。

+
例如：  `storagegrid_certificate.pem`

*** 选择*复制证书 PEM*或*复制 CA 包 PEM*以复制证书内容以便粘贴到其他地方。


.. 选择“*创建*”。+ 负载均衡器端点已创建。自定义证书用于 S3 客户端或管理接口与端点之间的所有后续新连接。


--
.生成证书
--
.. 选择*生成证书*。
.. 指定证书信息：
+
[cols="1a,3a"]
|===
| 字段 | 描述 


 a| 
域名
 a| 
证书中包含的一个或多个完全限定域名。使用 * 作为通配符来表示多个域名。



 a| 
IP
 a| 
证书中包含的一个或多个 IP 地址。



 a| 
主题（可选）
 a| 
证书所有者的 X.509 主题或专有名称 (DN)。

如果此字段未输入任何值，则生成的证书将使用第一个域名或 IP 地址作为主题通用名称 (CN)。



 a| 
有效天数
 a| 
证书创建后过期的天数。



 a| 
添加密钥使用扩展
 a| 
如果选择（默认和推荐），密钥使用和扩展密钥使用扩展将添加到生成的证书中。

这些扩展定义了证书中包含的密钥的用途。

*注意*：请选中此复选框，除非当证书包含这些扩展时您遇到与旧客户端的连接问题。

|===
.. 选择*生成*。
.. 选择*证书详细信息*以查看生成的证书的元数据。
+
*** 选择*下载证书*保存证书文件。
+
指定证书文件名和下载位置。使用扩展名保存文件 `.pem`。

+
例如：  `storagegrid_certificate.pem`

*** 选择*复制证书 PEM* 以复制证书内容并粘贴到其他地方。


.. 选择“*创建*”。
+
负载均衡器端点已创建。自定义证书用于 S3 客户端或管理接口与此端点之间的所有后续新连接。



--
====




=== 完成后

.步骤
. 如果您使用 DNS，请确保 DNS 包含一条记录，以将StorageGRID完全限定域名 (FQDN) 与客户端将用于建立连接的每个 IP 地址关联起来。
+
您在 DNS 记录中输入的 IP 地址取决于您是否使用负载平衡节点的 HA 组：

+
** 如果您已配置 HA 组，客户端将连接到该 HA 组的虚拟 IP 地址。
** 如果您不使用 HA 组，客户端将使用网关节点或管理节点的 IP 地址连接到StorageGRID负载均衡器服务。
+
您还必须确保 DNS 记录引用所有必需的端点域名，包括任何通配符名称。



. 向 S3 客户端提供连接到端点所需的信息：
+
** 端口号
** 完全限定域名或 IP 地址
** 任何所需的证书详细信息






== 查看和编辑负载均衡器端点

您可以查看现有负载均衡器端点的详细信息，包括安全端点的证书元数据。您可以更改端点的某些设置。

* 要查看所有负载均衡器端点的基本信息，请查看负载均衡器端点页面上的表格。
* 要查看有关特定端点的所有详细信息（包括证书元数据），请在表中选择该端点的名称。显示的信息根据端点类型及其配置方式而有所不同。
+
image::../media/load_balancer_endpoint_details.png[负载均衡器端点详细信息]

* 要编辑端点，请使用负载均衡器端点页面上的“操作”菜单。
+

NOTE: 如果在编辑管理接口端点的端口时失去对网格管理器的访问权限，请更新 URL 和端口以重新获得访问权限。

+

TIP: 编辑端点后，您可能需要等待最多 15 分钟才能将更改应用到所有节点。

+
[cols="1a, 2a,2a"]
|===
| 任务 | 操作菜单 | 详细信息页面 


 a| 
编辑端点名称
 a| 
.. 选中端点的复选框。
.. 选择*操作* > *编辑端点名称*。
.. 输入新名称。
.. 选择*保存*。

 a| 
.. 选择端点名称以显示详细信息。
.. 选择编辑图标image:../media/icon_edit_tm.png["编辑图标"]。
.. 输入新名称。
.. 选择*保存*。




 a| 
编辑端点端口
 a| 
.. 选中端点的复选框。
.. 选择“操作”>“编辑端点端口”
.. 输入有效的端口号。
.. 选择*保存*。

 a| 
_无_



 a| 
编辑端点绑定模式
 a| 
.. 选中端点的复选框。
.. 选择*操作* > *编辑端点绑定模式*。
.. 根据需要更新绑定模式。
.. 选择“保存更改”。

 a| 
.. 选择端点名称以显示详细信息。
.. 选择*编辑绑定模式*。
.. 根据需要更新绑定模式。
.. 选择“保存更改”。




 a| 
编辑端点证书
 a| 
.. 选中端点的复选框。
.. 选择*操作* > *编辑端点证书*。
.. 根据需要上传或生成新的自定义证书或开始使用全局 S3 证书。
.. 选择“保存更改”。

 a| 
.. 选择端点名称以显示详细信息。
.. 选择“*证书*”选项卡。
.. 选择*编辑证书*。
.. 根据需要上传或生成新的自定义证书或开始使用全局 S3 证书。
.. 选择“保存更改”。




 a| 
编辑租户访问权限
 a| 
.. 选中端点的复选框。
.. 选择*操作* > *编辑租户访问*。
.. 选择不同的访问选项，从列表中选择或删除租户，或同时执行这两项操作。
.. 选择“保存更改”。

 a| 
.. 选择端点名称以显示详细信息。
.. 选择“租户访问”选项卡。
.. 选择*编辑租户访问*。
.. 选择不同的访问选项，从列表中选择或删除租户，或同时执行这两项操作。
.. 选择“保存更改”。


|===




== 删除负载均衡器端点

您可以使用“操作”菜单删除一个或多个端点，也可以从详细信息页面中删除单个端点。


CAUTION: 为防止客户端中断，请在删除负载均衡器端点之前更新任何受影响的 S3 客户端应用程序。更新每个客户端以使用分配给另一个负载均衡器端点的端口进行连接。请务必更新所有必需的证书信息。


NOTE: 如果在删除管理接口端点时失去对网格管理器的访问权限，请更新 URL。

* 要删除一个或多个端点：
+
.. 在负载均衡器页面中，选中要删除的每个端点的复选框。
.. 选择*操作* > *删除*。
.. 选择“确定”。


* 要从详细信息页面中删除一个端点：
+
.. 从负载均衡器页面选择端点名称。
.. 在详细信息页面上选择“*删除*”。
.. 选择“确定”。



