---
permalink: expand/performing-expansion.html 
sidebar: sidebar 
keywords: expand, expansion procedure 
summary: 当您执行扩展时，新的网格节点将添加到您现有的StorageGRID部署中。 
---
= 执行扩展
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
当您执行扩展时，新的网格节点将添加到您现有的StorageGRID部署中。

.开始之前
* 您已使用link:../admin/web-browser-requirements.html["支持的网络浏览器"]。
* 您有配置密码。
* 您已部署此扩展中添加的所有网格节点。
* 你有link:../admin/admin-group-permissions.html["维护或 Root 访问权限"]。
* 如果您正在添加存储节点，则您已确认作为恢复的一部分执行的所有数据修复操作都已完成。看link:../maintain/checking-data-repair-jobs.html["检查数据修复作业"] 。
* 如果您正在添加存储节点，并且想要为这些节点分配自定义存储等级，那么您已经link:../ilm/creating-and-assigning-storage-grades.html["创建自定义存储等级"]。您还拥有 Root 访问权限或维护和 ILM 权限。
* 如果您要添加新站点，则您已经查看并更新了 ILM 规则。您必须确保在扩展完成之前，对象副本不会存储到新站点。例如，如果规则使用默认存储池（*所有存储节点*），则必须link:../ilm/creating-storage-pool.html["创建新的存储池"]仅包含现有存储节点和link:../ilm/working-with-ilm-rules-and-ilm-policies.html["更新 ILM 规则"]以及使用该新存储池的 ILM 策略。否则，一旦该站点的第一个节点变为活动状态，对象就会被复制到新站点。


.关于此任务
执行扩展包括以下主要用户任务：

. 配置扩展。
. 开始扩展。
. 下载新的恢复包文件。
. 监控扩展步骤和阶段，直到所有新节点都安装和配置完毕并且所有服务都已启动。
+

CAUTION: 一些扩展步骤和阶段可能需要花费大量时间才能在大型电网上运行。例如，如果 Cassandra 数据库为空，则将 Cassandra 流式传输到新的存储节点可能只需要几分钟。但是，如果 Cassandra 数据库包含大量对象元数据，则此阶段可能需要几个小时或更长时间。在“扩展 Cassandra 集群”或“启动 Cassandra 和流数据”阶段，请勿重新启动任何存储节点。



.步骤
. 选择*维护* > *任务* > *扩展*。
+
出现“电网扩展”页面。待处理节点部分列出了准备添加的节点。

+
image::../media/grid_expansion_page.png[显示网格扩展页面的屏幕截图]

. 选择*配置扩展*。
+
出现“站点选择”对话框。

. 选择您要开始的扩展类型：
+
** 如果要添加新站点，请选择“*新建*”，然后输入新站点的名称。
** 如果要向现有站点添加一个或多个节点，请选择“*现有*”。


. 选择*保存*。
. 查看*待处理节点*列表，并确认它显示了您部署的所有网格节点。
+
根据需要，您可以将光标放在节点的*网格网络 MAC 地址*上以查看有关该节点的详细信息。

+
image::../media/grid_node_details.png[网格节点详细信息的屏幕截图]

+

NOTE: 如果缺少节点，请确认该节点是否已成功部署。

. 从待处理节点列表中，批准您想要在此扩展中添加的节点。
+
.. 选择您要批准的第一个待处理网格节点旁边的单选按钮。
.. 选择*批准*。
+
出现网格节点配置表单。

.. 根据需要修改常规设置：
+
[cols="1a,2a"]
|===
| 字段 | 描述 


 a| 
站点
 a| 
网格节点将与之关联的站点的名称。如果要添加多个节点，请确保为每个节点选择正确的站点。如果您要添加新站点，则所有节点都会添加到新站点。



 a| 
名称
 a| 
节点的系统名称。系统名称是内部StorageGRID操作所必需的，并且不能更改。



 a| 
存储类型（仅限存储节点）
 a| 
*** *数据和元数据*（“组合”）：对象数据和元数据存储节点
*** *仅数据*：存储节点仅包含对象数据（无元数据）
*** *仅元数据*：仅包含元数据（无对象数据）的存储节点




 a| 
NTP 角色
 a| 
网格节点的网络时间协议（NTP）角色：

*** 选择“*自动*”（默认）以自动将 NTP 角色分配给节点。主要角色将分配给管理节点、具有 ADC 服务的存储节点、网关节点以及任何具有非静态 IP 地址的网格节点。客户端角色将被分配给所有其他网格节点。
*** 选择 *Primary* 手动将主 NTP 角色分配给节点。每个站点至少有两个节点应具有主要角色，以提供对外部计时源的冗余系统访问。
*** 选择“*客户端*”以手动将客户端 NTP 角色分配给节点。




 a| 
ADC 服务（组合或仅元数据存储节点）
 a| 
此存储节点是否将运行管理域控制器 (ADC) 服务。ADC 服务跟踪电网服务的位置和可用性。每个站点至少有三个存储节点必须包含 ADC 服务。部署 ADC 服务后，您无法将其添加到节点。

*** 如果您要更换的存储节点包括 ADC 服务，请选择*是*。因为如果剩余的 ADC 服务太少，您就无法停用存储节点，所以这可确保在删除旧服务之前有新的 ADC 服务可用。
*** 选择*自动*让系统确定该节点是否需要 ADC 服务。


了解link:../maintain/understanding-adc-service-quorum.html["ADC 仲裁"]。



 a| 
存储级（组合或仅数据存储节点）
 a| 
使用*默认*存储等级，或选择要分配给此新节点的自定义存储等级。

存储等级由 ILM 存储池使用，因此您的选择会影响哪些对象将放置在存储节点上。

|===
.. 根据需要修改网格网络、管理网络和客户端网络的设置。
+
*** *IPv4 地址 (CIDR)*：网络接口的 CIDR 网络地址。例如：172.16.10.100/24
+

NOTE: 如果您在批准节点时发现网格网络上的节点具有重复的 IP 地址，则必须取消扩展，重新部署具有非重复 IP 的虚拟机或设备，然后重新开始扩展。

*** *网关*：网格节点的默认网关。例如：172.16.10.1
*** *子网（CIDR）*：管理网络的一个或多个子网。


.. 选择*保存*。
+
已批准的网格节点将移至“已批准节点”列表。

+
*** 要修改已批准的网格节点的属性，请选择其单选按钮，然后选择*编辑*。
*** 要将已批准的网格节点移回待处理节点列表，请选择其单选按钮，然后选择*重置*。
*** 要永久删除已批准的电网节点，请关闭该节点的电源。然后，选择其单选按钮，并选择*删除*。


.. 对您想要批准的每个待处理的网格节点重复这些步骤。
+

NOTE: 如果可能的话，您应该批准所有待处理的网格注释并执行单一扩展。如果进行多次小规模扩展，则需要更多时间。



. 当您批准了所有网格节点后，输入*Provisioning Passphrase*，然后选择*Expand*。
+
几分钟后，此页面将更新以显示扩展过程的状态。当影响单个网格节点的任务正在进行时，“网格节点状态”部分会列出每个网格节点的当前状态。

+

NOTE: 在新设备的“安装网格节点”步骤中， StorageGRID设备安装程序显示安装从阶段 3 移动到阶段 4，即完成安装。当第 4 阶段完成后，控制器将重新启动。

+
image::../media/grid_expansion_progress.png[本图四周的文字提供了相关说明。]

+

NOTE: 站点扩展包括为新站点配置 Cassandra 的附加任务。

. 一旦出现*下载恢复包*链接，请下载恢复包文件。
+
对StorageGRID系统进行网格拓扑更改后，您必须尽快下载恢复包文件的更新副本。如果发生故障，恢复包文件允许您恢复系统。

+
.. 选择下载链接。
.. 输入配置密码，然后选择*开始下载*。
.. 下载完成后，打开 `.zip`文件并确认您可以访问其内容，包括 `Passwords.txt`文件。
.. 复制下载的恢复包文件(`.zip`）到两个安全、可靠且独立的位置。
+

CAUTION: 恢复包文件必须是安全的，因为它包含可用于从StorageGRID系统获取数据的加密密钥和密码。



. 如果您要向现有站点添加存储节点或添加站点，请监视 Cassandra 阶段，这些阶段发生在新网格节点上启动服务时。
+

CAUTION: 在“扩展 Cassandra 集群”或“启动 Cassandra 和流数据”阶段，请勿重新启动任何存储节点。对于每个新的存储节点，这些阶段可能需要花费数小时才能完成，特别是当现有存储节点包含大量对象元数据时。

+
[role="tabbed-block"]
====
.添加存储节点
--
如果要将存储节点添加到现有站点，请查看“启动 Cassandra 和流数据”状态消息中显示的百分比。

image::../media/grid_expansion_starting_cassandra.png[网格扩展 > 启动 Cassandra 和流数据]

该百分比根据可用的 Cassandra 数据总量和已写入新节点的数据量来估计 Cassandra 流操作的完成程度。

--
.添加站点
--
如果您要添加新站点，请使用 `nodetool status`监控 Cassandra 流的进度，并查看在“扩展 Cassandra 集群”阶段有多少元数据被复制到新站点。新站点上的总数据负载应在当前站点总数据负载的 20% 左右以内。

--
====
. 继续监控扩展，直到所有任务完成并且*配置扩展*按钮重新出现。


.完成后
根据您添加的网格节点类型，执行额外的集成和配置步骤。看link:configuring-expanded-storagegrid-system.html["扩容后配置步骤"] 。
