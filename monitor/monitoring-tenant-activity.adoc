---
permalink: monitor/monitoring-tenant-activity.html 
sidebar: sidebar 
keywords: how to monitor tenant activity 
summary: 所有 S3 客户端活动都与StorageGRID租户帐户相关联。您可以使用网格管理器监控所有租户或特定租户的存储使用情况或网络流量。您可以使用审计日志或 Grafana 仪表板来收集有关租户如何使用StorageGRID 的更多详细信息。 
---
= 监控租户活动
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
所有 S3 客户端活动都与StorageGRID租户帐户相关联。您可以使用网格管理器监控所有租户或特定租户的存储使用情况或网络流量。您可以使用审计日志或 Grafana 仪表板来收集有关租户如何使用StorageGRID 的更多详细信息。

.开始之前
* 您已使用link:../admin/web-browser-requirements.html["支持的网络浏览器"]。
* 你有link:../admin/admin-group-permissions.html["根访问权限或租户帐户权限"]。




== 查看所有租户

租户页面显示所有当前租户帐户的基本信息。

.步骤
. 选择*租户*。
. 查看租户页面上显示的信息。
+
列出了每个租户使用的逻辑空间、配额使用情况、配额和对象数量。如果没有为租户设置配额，则配额使用情况和配额字段包含破折号 (&#8212;)。

+

NOTE: 所用空间值为估计值。这些估计受到摄取时间、网络连接和节点状态的影响。

+
image::../media/tenant_accounts_page.png[租户账户页面]

. （可选）通过选择登录链接登录到租户帐户image:../media/icon_tenant_sign_in.png["租户登录图标"]在*Sign in/复制URL*栏中。
. （可选）通过选择复制 URL 链接复制租户登录页面的 URLimage:../media/icon_tenant_copy_url.png["租户复制 URL 图标"]在*Sign in/复制URL*栏中。
. 或者，选择“导出为 CSV”来查看和导出 `.csv`包含所有租户的使用值的文件。
+
系统会提示您打开或保存 `.csv`文件。

+
的内容 `.csv`文件如下例所示：

+
image::../media/tenant_accounts_example_csv.png[租户帐户示例 .csv]

+
您可以打开 `.csv`在电子表格应用程序中保存文件或在自动化中使用它。

. 如果没有列出任何对象，则可以选择“*操作*”>“*删除*”来删除一个或多个租户。看link:../admin/deleting-tenant-account.html["删除租户帐户"] 。
+
如果租户帐户包含任何存储桶或容器，则您无法删除该帐户。





== 查看特定租户

您可以查看特定租户的详细信息。

.步骤
. 从租户页面中选择租户名称。
+
出现租户详细信息页面。

+
image::../media/tenant_usage_modal.png[租户使用模式]

. 查看页面顶部的租户概览。
+
详细信息页面的此部分提供租户的摘要信息，包括租户的对象数、配额使用情况、已使用的逻辑空间和配额设置。

. 从*空间细分*选项卡中，查看*空间消耗*图表。
+
此图表显示了租户所有 S3 存储桶的总空间消耗。

+
如果为此租户设置了配额，则已用配额量和剩余配额量将以文本形式显示（例如， `85.00 GB of 100 GB used` ）。如果没有设置配额，则租户拥有无限配额，并且文本仅包含已使用的空间量（例如， `85.00 GB used` ）。条形图显示每个桶或容器中的配额百分比。如果租户超出存储配额 1% 以上且至少 1 GB，则图表会显示总配额和超出量。

+
您可以将光标放在条形图上来查看每个存储桶或容器使用的存储空间。您可以将光标放在可用空间部分上以查看剩余的存储配额量。

+
image::../media/tenant_bucket_space_consumption_GM.png[租户存储桶消耗条形图]

+

CAUTION: 配额使用基于内部估计，在某些情况下可能会超出。例如，当租户开始上传对象时， StorageGRID会检查配额，如果租户超出配额，则会拒绝新的摄取。但是， StorageGRID在确定是否超出配额时不会考虑当前上传的大小。如果对象被删除，租户可能会暂时无法上传新对象，直到重新计算配额使用情况。配额使用情况计算可能需要 10 分钟或更长时间。

+

NOTE: 租户的配额使用情况表示租户已上传到StorageGRID 的对象数据总量（逻辑大小）。配额使用情况并不代表用于存储这些对象的副本及其元数据（物理大小）的空间。

+

NOTE: 您可以启用“租户配额使用率高”警报规则来确定租户是否正在消耗其配额。如果启用，当租户使用了其配额的 90% 时会触发此警报。有关说明，请参阅link:../monitor/editing-alert-rules.html["编辑警报规则"]。

. 从“*空间细分*”选项卡中，查看“存储桶详细信息*”。
+
该表列出了租户的 S3 存储桶。已用空间是存储桶或容器中的对象数据总量。此值不代表 ILM 副本和对象元数据所需的存储空间。

. 或者，选择“导出到 CSV”来查看和导出包含每个存储桶或容器的使用值的 .csv 文件。
+
单个 S3 租户的内容 `.csv`文件如下例所示：

+
image::../media/tenant_bucket_details_csv.png[租户存储桶详细信息 CSV 示例]

+
您可以打开 `.csv`在电子表格应用程序中保存文件或在自动化中使用它。

. 或者，选择“*允许的功能*”选项卡来查看为租户启用的权限和功能的列表。看link:../admin/editing-tenant-account.html["编辑租户帐户"]如果您需要更改任何这些设置。
. 如果租户具有*使用网格联合连接*权限，则可以选择*网格联合*选项卡来了解有关连接的更多信息。
+
看link:../admin/grid-federation-overview.html["什么是电网联合？"]和link:../admin/grid-federation-manage-tenants.html["管理电网联合的允许租户"]。





== 查看网络流量

如果某个租户有流量分类策略，请检查该租户的网络流量。

.步骤
. 选择*配置* > *网络* > *流量分类*。
+
出现“流量分类策略”页面，现有策略列在表中。

. 查看政策列表以确定适用于特定租户的政策。
. 要查看与策略相关的指标，请选择策略左侧的单选按钮，然后选择*指标*。
. 分析图表以确定策略限制流量的频率以及是否需要调整策略。


看link:../admin/managing-traffic-classification-policies.html["管理流量分类策略"]了解更多信息。



== 使用审核日志

或者，您可以使用审计日志来更细致地监控租户的活动。

例如，您可以监控以下类型的信息：

* 特定的客户端操作，例如 PUT、GET 或 DELETE
* 对象大小
* 应用于对象的 ILM 规则
* 客户端请求的源IP


审计日志写入文本文件，您可以使用您选择的日志分析工具进行分析。这使您能够更好地了解客户活动，或实施复杂的退款和计费模型。

看link:../audit/index.html["审查审计日志"]了解更多信息。



== 使用 Prometheus 指标

或者，使用 Prometheus 指标来报告租户活动。

* 在网格管理器中，选择 *SUPPORT* > *Tools* > *Metrics*。您可以使用现有的仪表板（例如 S3 概览）来查看客户活动。
+

NOTE: 指标页面上提供的工具主要供技术支持使用。这些工具中的某些功能和菜单项故意不起作用。

* 从网格管理器的顶部，选择帮助图标并选择*API 文档*。您可以使用网格管理 API 的指标部分中的指标来为租户活动创建自定义警报规则和仪表板。


看link:reviewing-support-metrics.html["审查支持指标"]了解更多信息。
