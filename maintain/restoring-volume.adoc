---
permalink: maintain/restoring-volume.html 
sidebar: sidebar 
keywords: storagegrid, restore, volume 
summary: 您可以使用网格管理器恢复故障存储卷或存储节点的对象数据。您还可以使用网格管理器来监控正在进行的恢复过程并显示恢复历史记录。 
---
= 使用网格管理器恢复对象数据
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
您可以使用网格管理器恢复故障存储卷或存储节点的对象数据。您还可以使用网格管理器来监控正在进行的恢复过程并显示恢复历史记录。

.开始之前
* 您已完成以下任一步骤来格式化失败的卷：
+
** link:../maintain/remounting-and-reformatting-appliance-storage-volumes.html["重新挂载并重新格式化设备存储卷（手动步骤）"]
** link:../maintain/remounting-and-reformatting-storage-volumes-manual-steps.html["重新挂载并重新格式化存储卷（手动步骤）"]


* 您已确认要恢复对象的存储节点的连接状态为“已连接”image:../media/icon_alert_green_checkmark.png["图标警报绿色复选标记"]在网格管理器中的 *NODES* > *Overview* 选项卡上。
* 您已确认以下内容：
+
** 尚未进行添加存储节点的网格扩展。
** 存储节点退役未在进行中或已失败。
** 故障存储卷的恢复尚未进行。
** 系统驱动器发生故障的存储节点的恢复尚未进行。
** EC 重新平衡作业尚未进行。
** 设备节点克隆未在进行中。




.关于此任务
更换驱动器并执行手动步骤格式化卷后，网格管理器会在 *维护* > *卷恢复* > *要恢复的节点* 选项卡上将这些卷显示为恢复的候选卷。

只要有可能，就使用网格管理器中的卷恢复页面恢复对象数据。您可以<<enable-auto-restore-mode,启用自动恢复模式>>当卷准备好恢复时自动启动卷恢复，或者<<manually-restore,手动执行卷恢复>>。请遵循以下准则：

* 如果卷在 *维护* > *卷恢复* > *要恢复的节点* 中列出，请按照以下步骤恢复对象数据。如果满足以下条件，则会列出卷：
+
** 节点中的部分（但不是全部）存储卷发生故障
** 节点中的所有存储卷均已发生故障，并且正在被相同数量的卷或更多卷替换


+
网格管理器中的卷恢复页面还允许您<<view-restoration-progress,监控卷恢复过程>>和<<view-restoration-history,查看恢复历史记录>>。

* 如果网格管理器中未列出要恢复的卷，请按照适当的步骤使用 `repair-data`恢复对象数据的脚本：
+
** link:restoring-object-data-to-storage-volume.html["将对象数据还原到存储卷（系统驱动器故障）"]
** link:restoring-object-data-to-storage-volume-where-system-drive-is-intact.html["将对象数据恢复到系统驱动器完好的存储卷"]
** link:restoring-object-data-to-storage-volume-for-appliance.html["将对象数据还原到设备的存储卷"]
+

NOTE: 修复数据脚本已弃用，并将在未来版本中删除。



+
如果恢复的存储节点包含的卷少于它所替换的节点，则必须使用 `repair-data`脚本。



您可以恢复两种类型的对象数据：

* 假设网格的 ILM 规则已配置为使对象副本可用，则复制的数据对象将从其他位置恢复。
+
** 如果 ILM 规则配置为仅存储一个复制副本，并且该副本存在于发生故障的存储卷上，则您将无法恢复该对象。
** 如果对象的唯一剩余副本位于云存储池中，StorageGRID必须向云存储池端点发出多个请求来恢复对象数据。


* 通过重新组装存储的片段来恢复擦除编码 (EC) 数据对象。损坏或丢失的片段由擦除编码算法从剩余的数据和奇偶校验片段中重新创建。
+
当某些存储节点处于离线状态时，可以开始修复擦除编码数据。然而，如果无法解释所有擦除编码数据，则无法完成修复。所有节点可用后修复将完成。




NOTE: 卷恢复取决于存储对象副本的资源的可用性。卷恢复的进度是非线性的，可能需要几天或几周才能完成。



== [[enable-auto-restore-mode]]启用自动恢复模式

启用自动还原模式后，当卷准备好还原时，卷还原将自动开始。

.步骤
. 在网格管理器中转到*维护*>*卷恢复*。
. 选择*要恢复的节点*选项卡，然后将*自动恢复模式*的开关滑动到启用位置。
. 当出现确认对话框时，请检查详细信息。
+
[NOTE]
====
** 您将无法在任何节点上手动启动卷恢复作业。
** 仅当没有其他维护程序正在进行时，卷恢复才会自动开始。
** 您可以从进度监控页面监控作业的状态。
** StorageGRID会自动重试启动失败的卷恢复。


====
. 当您了解启用自动恢复模式的结果时，请在确认对话框中选择*是*。
+
您可以随时禁用自动恢复模式。





== [[manually-restore]]手动恢复失败的卷或节点

按照以下步骤恢复故障的卷或节点。

.步骤
. 在网格管理器中转到*维护*>*卷恢复*。
. 选择“*要恢复的节点*”选项卡，然后将“*自动恢复模式*”的开关滑动到禁用位置。
+
选项卡上的数字表示需要恢复卷的节点数。

. 展开每个节点以查看其中需要恢复的卷及其状态。
. 纠正任何阻碍每个卷恢复的问题。如果它显示为卷状态，则当您选择“等待手动步骤”时会指示问题。
. 选择要还原的所有卷均指示“准备还原”状态的节点。
+
一次只能还原一个节点的卷。

+
节点中的每个卷都必须表明它已准备好恢复。

. 选择*开始恢复*。
. 解决可能出现的任何警告或选择*仍然开始*以忽略警告并开始恢复。


当恢复开始时，节点会从*要恢复的节点*选项卡移动到*恢复进度*选项卡。

如果无法启动卷恢复，节点将返回到“要恢复的节点”选项卡。



== [[view-restoration-progress]]查看恢复进度

*恢复进度*选项卡显示卷恢复过程的状态以及正在恢复的节点的卷的信息。

所有卷中复制和纠删码对象的数据修复率是所有正在进行的修复的平均值，包括使用 `repair-data`脚本。还标出了这些卷中完好无损且不需要修复的物体的百分比。


NOTE: 复制数据的恢复取决于存储复制副本的资源的可用性。复制数据恢复的进度是非线性的，可能需要几天或几周才能完成。

恢复作业部分显示从网格管理器启动的卷恢复的信息。

* 恢复作业部分标题中的数字表示正在恢复或排队等待恢复的卷的数量。
* 该表显示有关正在恢复的节点中每个卷的信息及其进度。
+
** 每个节点的进度显示每个作业的百分比。
** 展开详细信息列以显示恢复开始时间和作业 ID。


* 如果卷恢复失败：
+
** 状态列显示 `failed (attempting retry)`，并将自动重试。
** 如果多个恢复作业失败，则将首先自动重试最近的作业。
** 如果重试继续失败，则会触发*EC 修复失败*警报。按照警报中的步骤解决问题。






== [[view-restoration-history]]查看恢复历史记录

*恢复历史*选项卡显示有关所有已成功完成的卷恢复的信息。


NOTE: 大小不适用于复制的对象，并且仅出现在包含擦除编码 (EC) 数据对象的恢复中。
