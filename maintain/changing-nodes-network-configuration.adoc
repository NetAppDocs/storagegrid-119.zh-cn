---
permalink: maintain/changing-nodes-network-configuration.html 
sidebar: sidebar 
keywords: storagegrid, network configuration, node network configuration 
summary: 您可以使用更改 IP 工具更改一个或多个节点的网络配置。您可以更改网格网络的配置，或者添加、更改或删除管理或客户端网络。 
---
= 更改节点网络配置
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
您可以使用更改 IP 工具更改一个或多个节点的网络配置。您可以更改网格网络的配置，或者添加、更改或删除管理或客户端网络。

.开始之前
你有 `Passwords.txt`文件。

.关于此任务
*Linux：*如果您是第一次将网格节点添加到管理网络或客户端网络，并且之前没有在节点配置文件中配置 ADMIN_NETWORK_TARGET 或 CLIENT_NETWORK_TARGET，则必须现在这样做。

请参阅适用于您的 Linux 操作系统的StorageGRID安装说明：

* link:../rhel/index.html["在 Red Hat Enterprise Linux 上安装StorageGRID"]
* link:../ubuntu/index.html["在 Ubuntu 或 Debian 上安装StorageGRID"]


*设备：*在StorageGRID设备上，如果在初始安装期间未在StorageGRID设备安装程序中配置客户端或管理网络，则无法仅使用更改 IP 工具添加网络。首先，你必须 https://docs.netapp.com/us-en/storagegrid-appliances/commonhardware/placing-appliance-into-maintenance-mode.html["将设备置于维护模式"^]，配置链接，使设备恢复正常运行模式，然后使用更改 IP 工具修改网络配置。查看 https://docs.netapp.com/us-en/storagegrid-appliances/installconfig/configuring-network-links.html["配置网络链接的过程"^]。

您可以更改任何网络上一个或多个节点的 IP 地址、子网掩码、网关或 MTU 值。

您还可以从客户端网络或管理网络中添加或删除节点：

* 您可以通过向节点添加该网络上的 IP 地址/子网掩码，将节点添加到客户端网络或管理网络。
* 您可以通过删除该网络上节点的 IP 地址/子网掩码来从客户端网络或管理网络中删除节点。
+
节点不能从网格网络中删除。




NOTE: 不允许交换 IP 地址。如果必须在网格节点之间交换 IP 地址，则必须使用临时中间 IP 地址。


NOTE: 如果您的StorageGRID系统启用了单点登录 (SSO) 并且您正在更改管理节点的 IP 地址，请注意，使用管理节点的 IP 地址（而不是建议的完全限定域名）配置的任何依赖方信任都将变为无效。您将无法再登录该节点。更改 IP 地址后，必须立即使用新的 IP 地址更新或重新配置 Active Directory 联合身份验证服务 (AD FS) 中节点的信赖方信任。请参阅说明link:../admin/configuring-sso.html["配置 SSO"]。


NOTE: 使用更改 IP 工具对网络所做的任何更改都会传播到StorageGRID设备的安装程序固件。这样，如果在设备上重新安装StorageGRID软件，或者将设备置于维护模式，则网络配置将是正确的。

.步骤
. 登录到主管理节点：
+
.. 输入以下命令： `ssh admin@_primary_Admin_Node_IP_`
.. 输入 `Passwords.txt`文件。
.. 输入以下命令切换到root： `su -`
.. 输入 `Passwords.txt`文件。


+
当您以 root 身份登录时，提示符将从 `$`到 `#`。

. 输入以下命令启动更改 IP 工具： `change-ip`
. 在提示符下输入配置密码。
+
出现主菜单。

+
image::../media/change_ip_tool_main_menu.png[屏幕截图显示了更改 IP 工具的欢迎屏幕]

. （可选）选择 *1* 来选择要更新的节点。然后选择以下选项之一：
+
** *1*: 单节点--按名称选择
** *2*：单节点——按站点选择，然后按名称选择
** *3*: 单节点——按当前IP选择
** *4*：站点上的所有节点
** *5*：网格中的所有节点
+
*注意：*如果您想更新所有节点，请允许“全部”保持选中状态。



+
做出选择后，将出现主菜单，其中“选定节点”字段将更新以反映您的选择。所有后续操作仅对显示的节点执行。

. 在主菜单上，选择选项*2*来编辑所选节点的 IP/掩码、网关和 MTU 信息。
+
.. 选择要进行更改的网络：
+
--
*** *1*：网格网络
*** *2*：管理网络
*** *3*：客户端网络
*** *4*：所有网络


--
+
--
做出选择后，提示会显示节点名称、网络名称（网格、管理或客户端）、数据类型（IP/掩码、网关或 MTU）和当前值。

编辑 DHCP 配置接口的 IP 地址、前缀长度、网关或 MTU 将会把接口更改为静态。当您选择更改由 DHCP 配置的接口时，会显示一条警告，通知您该接口将更改为静态。

接口配置为 `fixed`無法編輯。

--
.. 要设置新值，请按照当前值显示的格式输入。
.. 要保持当前值不变，请按 *Enter*。
.. 如果数据类型是 `IP/mask`，您可以通过输入 *d* 或 *0.0.0.0/0* 从节点中删除管理网络或客户端网络。
.. 编辑完所有想要更改的节点后，输入 *q* 返回主菜单。
+
您的更改将保留，直到被清除或应用为止。



. 选择以下选项之一来检查您的更改：
+
** *5*：在隔离的输出中显示编辑，仅显示更改的项目。更改以绿色（添加）或红色（删除）突出显示，如示例输出所示：
+
image::../media/change_ip_tool_edit_ip_mask_sample_output.png[屏幕截图由周围文字描述]

** *6*：在显示完整配置的输出中显示编辑。更改以绿色（添加）或红色（删除）突出显示。
+

NOTE: 某些命令行界面可能会使用删除线格式显示添加和删除的内容。正确显示取决于您的终端客户端是否支持必要的 VT100 转义序列。



. 选择选项 *7* 来验证所有更改。
+
此验证可确保不违反网格、管理和客户端网络的规则，例如不使用重叠子网。

+
在此示例中，验证返回错误。

+
image::../media/change_ip_tool_validate_sample_error_messages.gif[屏幕截图由周围文字描述]

+
在此示例中，验证已通过。

+
image::../media/change_ip_tool_validate_sample_passed_messages.gif[屏幕截图由周围文字描述]

. 验证通过后，选择以下选项之一：
+
** *8*：保存未应用的更改。
+
此选项允许您退出更改 IP 工具并稍后重新启动，而不会丢失任何未应用的更改。

** *10*：应用新的网络配置。


. 如果您选择了选项 *10*，请选择以下选项之一：
+
** *应用*：立即应用更改，并在必要时自动重启每个节点。
+
如果新的网络配置不需要任何物理网络更改，您可以选择*应用*立即应用更改。如果需要，节点将自动重启。将显示需要重启的节点。

** *阶段*：下次手动重启节点时应用更改。
+
如果需要对物理或虚拟网络配置进行更改以使新的网络配置正常运行，则必须使用 *stage* 选项，关闭受影响的节点，进行必要的物理网络更改，然后重新启动受影响的节点。如果您在没有先进行这些网络更改的情况下选择*应用*，则更改通常会失败。

+

NOTE: 如果您使用 *stage* 选项，则必须在暂存后尽快重新启动节点以尽量减少中断。

** *取消*：此时不要进行任何网络更改。
+
如果您不知道所提议的更改需要重新启动节点，您可以推迟更改以尽量减少对用户的影响。选择“*取消*”将返回主菜单并保存您的更改，以便您稍后应用它们。

+
当您选择*apply*或*stage*时，将生成一个新的网络配置文件，执行配置，并使用新的工作信息更新节点。

+
在配置期间，输出显示应用更新的状态。

+
[listing]
----
Generating new grid networking description file...

Running provisioning...

Updating grid network configuration on Name
----


+
应用或阶段更改后，将根据网格配置更改生成新的恢复包。

. 如果您选择了 *stage*，请在配置完成后按照以下步骤操作：
+
.. 进行所需的物理或虚拟网络更改。
+
*物理网络变化*：进行必要的物理网络变化，必要时安全关闭节点。

+
*Linux*：如果您是第一次将节点添加到管理网络或客户端网络，请确保已按照link:linux-adding-interfaces-to-existing-node.html["Linux：向现有节点添加接口"]。

.. 重新启动受影响的节点。


. 更改完成后，选择 *0* 退出更改 IP 工具。
. 从网格管理器下载新的恢复包。
+
.. 选择*维护* > *系统* > *恢复包*。
.. 输入配置密码。



