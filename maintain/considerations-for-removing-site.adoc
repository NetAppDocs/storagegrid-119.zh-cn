---
permalink: maintain/considerations-for-removing-site.html 
sidebar: sidebar 
keywords: how to remove site 
summary: 在使用站点退役程序删除站点之前，您必须查看注意事项。 
---
= 删除网站的注意事项
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
在使用站点退役程序删除站点之前，您必须查看注意事项。



== 当你关闭一个网站时会发生什么

当您退役某个站点时， StorageGRID会从StorageGRID系统中永久删除该站点上的所有节点以及站点本身。

当场地退役程序完成后：

* 您无法再使用StorageGRID查看或访问该站点或站点上的任何节点。
* 您不能再使用引用该站点的任何存储池或擦除编码配置文件。当StorageGRID退役某个站点时，它会自动删除这些存储池并停用这些擦除编码配置文件。




== 连接站点和断开站点退役程序之间的差异

您可以使用站点退役程序来删除所有节点都连接到StorageGRID 的站点（称为连接站点退役）或删除所有节点都与StorageGRID断开连接的站点（称为断开站点退役）。在开始之前，您必须了解这些过程之间的区别。


NOTE: 如果一个站点包含连接的混合物（image:../media/icon_alert_green_checkmark.png["图标警报绿色复选标记"] ) 和断开的节点 (image:../media/icon_alarm_gray_administratively_down.png["图标警报灰色管理关闭"]或者image:../media/icon_alarm_blue_unknown.png["图标警报蓝色未知"])，您必须将所有离线节点重新联机。

* 连接站点退役允许您从StorageGRID系统中删除一个可操作站点。例如，您可以执行已连接站点退役来删除可运行但不再需要的站点。
* 当StorageGRID删除连接的站点时，它会使用 ILM 来管理该站点的对象数据。在开始已连接站点退役之前，您必须从所有 ILM 规则中删除该站点并激活新的 ILM 策略。迁移对象数据的 ILM 流程和删除站点的内部流程可以同时发生，但最佳做法是在开始实际退役程序之前让 ILM 步骤完成。
* 断开连接的站点退役允许您从StorageGRID系统中删除故障站点。例如，您可以执行断开站点退役来移除已被火灾或洪水摧毁的站点。
+
当StorageGRID删除断开连接的站点时，它会认为所有节点都不可恢复，并且不会尝试保存数据。但是，在开始断开站点的退役之前，您必须从所有 ILM 规则中删除该站点并激活新的 ILM 策略。

+

CAUTION: 在执行断开站点退役程序之前，您必须联系您的NetApp客户代表。在启用“退役站点”向导中的所有步骤之前， NetApp将会审核您的要求。如果您认为有可能恢复站点或从站点恢复对象数据，则不应尝试断开站点的退役。





== 删除已连接或已断开连接的站点的一般要求

在删除已连接或已断开连接的站点之前，您必须注意以下要求：

* 您不能停用包含主管理节点的站点。
* 如果任何节点具有属于高可用性 (HA) 组的接口，则您无法停用该站点。您必须编辑 HA 组以删除节点的接口或删除整个 HA 组。
* 如果一个站点包含混合连接（image:../media/icon_alert_green_checkmark.png["图标警报绿色复选标记"] ) 和断开连接 (image:../media/icon_alarm_blue_unknown.png["图标警报蓝色未知"]或者image:../media/icon_alarm_gray_administratively_down.png["图标警报灰色管理关闭"]) 节点。
* 如果任何其他站点上的任何节点断开连接，则无法停用该站点（image:../media/icon_alarm_blue_unknown.png["图标警报蓝色未知"]或者image:../media/icon_alarm_gray_administratively_down.png["图标警报灰色管理关闭"]）。
* 如果 ec-node-repair 操作正在进行中，则您无法启动站点退役程序。看link:checking-data-repair-jobs.html["检查数据修复作业"]跟踪擦除编码数据的修复。
* 在站点退役程序运行时：
+
** 您不能创建引用已退役站点的 ILM 规则。您也无法编辑现有的 ILM 规则来引用该站点。
** 您无法执行其他维护程序，例如扩展或升级。
+

NOTE: 如果您需要在已连接站点退役期间执行其他维护程序，您可以link:pausing-and-resuming-decommission-process-for-storage-nodes.html["在存储节点被移除时暂停该过程"]。仅当达到 ILM 评估或擦除编码数据退役阶段时才会启用 *暂停* 按钮；但是，ILM 评估（数据迁移）将继续在后台运行。第二次维护程序完成后，即可恢复退役。

** 如果您需要在启动站点退役程序后恢复任何节点，则必须联系支持人员。


* 您不能一次停用多个站点。
* 如果站点包含一个或多个管理节点，并且您的StorageGRID系统启用了单点登录 (SSO)，则必须从 Active Directory 联合身份验证服务 (AD FS) 中删除该站点的所有依赖方信任。




== 信息生命周期管理（ILM）的要求

作为删除站点的一部分，您必须更新 ILM 配置。退役站点向导将指导您完成一系列先决条件步骤，以确保以下内容：

* 任何 ILM 政策均未提及该网站。如果是，您必须编辑策略或使用新的 ILM 规则创建并激活策略。
* 没有 ILM 规则引用该站点，即使这些规则未在任何策略中使用。您必须删除或编辑所有涉及该站点的规则。


当StorageGRID退役该站点时，它将自动停用引用该站点的任何未使用的擦除编码配置文件，并且它将自动删除引用该站点的任何未使用的存储池。如果所有存储节点存储池存在（StorageGRID 11.6 及更早版本），则会将其删除，因为它使用所有站点。


CAUTION: 在删除站点之前，您可能需要创建新的 ILM 规则并激活新的 ILM 策略。这些说明假设您对 ILM 的工作原理有充分的了解，并且熟悉创建存储池、擦除编码配置文件、ILM 规则以及模拟和激活 ILM 策略。看link:../ilm/index.html["使用 ILM 管理对象"] 。



== 连接站点的对象数据注意事项

如果您正在执行已连接站点的退役，则必须决定在创建新的 ILM 规则和新的 ILM 策略时如何处理站点上的现有对象数据。您可以执行以下一项或两项操作：

* 将对象数据从选定站点移动到网格中的一个或多个其他站点。
+
*移动数据的示例*：假设您想要停用罗利的一个站点，因为您在桑尼维尔添加了一个新站点。在此示例中，您想将所有对象数据从旧站点移动到新站点。在更新 ILM 规则和 ILM 策略之前，您必须检查两个站点的容量。您必须确保桑尼维尔站点具有足够的容量来容纳来自罗利站点的对象数据，并且桑尼维尔将保留足够的容量以满足未来的增长。

+

NOTE: 为了确保有足够的容量，您可能需要link:../expand/index.html["展开网格"]在执行此过程之前，通过将存储卷或存储节点添加到现有站点或添加新站点来实现。

* 从选定站点删除对象副本。
+
*删除数据的示例*：假设您当前使用 3 副本 ILM 规则在三个站点之间复制对象数据。在退役站点之前，您可以创建等效的 2 副本 ILM 规则以仅在两个站点存储数据。当您激活使用 2 副本规则的新 ILM 策略时， StorageGRID会从第三个站点删除副本，因为它们不再满足 ILM 要求。但是，对象数据仍将受到保护，并且其余两个站点的容量将保持不变。

+

CAUTION: 切勿创建单一副本 ILM 规则来适应站点的删除。任何时间段内仅创建一个复制副本的 ILM 规则会使数据面临永久丢失的风险。如果某个对象的副本只有一个，则当存储节点发生故障或出现重大错误时，该对象将会丢失。在升级等维护过程中，您还会暂时失去对该对象的访问权限。





== 已连接站点退役的附加要求

在StorageGRID删除已连接的站点之前，您必须确保以下事项：

* StorageGRID系统中的所有节点都必须具有 *Connected* 的连接状态（image:../media/icon_alert_green_checkmark.png["图标警报绿色复选标记"] ）；但是，节点可以有活动警报。
+

NOTE: 如果一个或多个节点断开连接，您可以完成“退役站点”向导的步骤 1-4。但是，除非所有节点都已连接，否则您无法完成向导的第 5 步（即启动退役过程）。

* 如果您计划删除的站点包含用于负载平衡的网关节点或管理节点，则可能需要link:../expand/index.html["展开网格"]在另一个站点添加等效的新节点。在开始站点退役程序之前，请确保客户端可以连接到替换节点。
* 如果您计划删除的站点包含高可用性 (HA) 组中的任何网关节点或管理节点，您可以完成退役站点向导的步骤 1-4。但是，除非您从所有 HA 组中删除这些节点，否则您无法完成向导的第 5 步（即启动退役过程）。如果现有客户端连接到包含站点节点的 HA 组，则必须确保它们在站点被删除后可以继续连接到StorageGRID 。
* 如果客户端直接连接到您计划移除的站点的存储节点，则必须确保它们可以在开始站点退役程序之前连接到其他站点的存储节点。
* 您必须在剩余站点上提供足够的空间来容纳由于任何活动 ILM 策略的更改而移动的任何对象数据。在某些情况下，您可能需要link:../expand/index.html["展开网格"]通过添加存储节点、存储卷或新站点，然后才能完成已连接站点的退役。
* 您必须留出足够的时间来完成退役程序。  StorageGRID ILM 流程可能需要几天、几周甚至几个月的时间才能从站点移动或删除对象数据，然后才能退役站点。
+

NOTE: 从站点移动或删除对象数据可能需要几天、几周甚至几个月的时间，具体取决于站点的数据量、系统负载、网络延迟以及所需 ILM 更改的性质。

* 只要有可能，您就应该尽早完成退役站点向导的第 1-4 步。如果您允许在开始实际退役程序之前将数据从站点移出（通过在向导的第 5 步中选择“开始退役”*），则退役程序将更快完成，中断和性能影响更少。




== 已断开站点退役的附加要求

在StorageGRID删除断开连接的站点之前，您必须确保以下事项：

* 您已联系您的NetApp客户代表。在启用“退役站点”向导中的所有步骤之前， NetApp将会审核您的要求。
+

CAUTION: 如果您认为有可能恢复站点或从站点恢复任何对象数据，则不应尝试断开站点的退役。看link:how-site-recovery-is-performed-by-technical-support.html["技术支持如何恢复站点"] 。

* 站点上的所有节点必须具有以下之一的连接状态：
+
** *未知* (image:../media/icon_alarm_blue_unknown.png["图标警报蓝色未知"] ): 由于未知原因，节点断开连接或节点上的服务意外关闭。例如，节点上的服务可能已停止，或者由于电源故障或意外中断，节点可能已失去网络连接。
** *行政上下降* (image:../media/icon_alarm_gray_administratively_down.png["图标警报灰色管理关闭"] ): 由于预期原因，节点未连接到电网。例如，节点或节点上的服务已被正常关闭。


* 所有其他站点上的所有节点必须具有 *Connected* 的连接状态（image:../media/icon_alert_green_checkmark.png["图标警报绿色复选标记"] ）；但是，这些其他节点可以有活动警报。
* 您必须明白，您将无法再使用StorageGRID查看或检索存储在该站点的任何对象数据。当StorageGRID执行此过程时，它不会尝试保留断开连接的站点的任何数据。
+

NOTE: 如果您的 ILM 规则和策略旨在防止单个站点丢失，则对象的副本仍然存在于其余站点上。

* 您必须明白，如果该站点包含某个对象的唯一副本，则该对象将丢失并且无法检索。




== 删除网站时的一致性注意事项

S3 存储桶的一致性决定了StorageGRID在告知客户端对象提取成功之前是否将对象元数据完全复制到所有节点和站点。一致性在对象的可用性和不同存储节点和站点之间的对象的一致性之间提供了平衡。

当StorageGRID删除一个站点时，它需要确保没有数据写入被删除的站点。因此，它会暂时覆盖每个桶或容器的一致性。启动站点退役过程后， StorageGRID会暂时使用强站点一致性来防止对象元数据被写入被删除的站点。

由于此临时覆盖，请注意，如果剩余站点上的多个节点变得不可用，则站点退役期间发生的任何客户端写入、更新和删除操作都可能失败。
