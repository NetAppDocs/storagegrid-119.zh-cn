---
permalink: ilm/example-8-priorities-for-s3-bucket-lifecycle-and-ilm-policy.html 
sidebar: sidebar 
keywords: retention priority, example S3 bucket lifecycle, example ILM policy 
summary: 根据您的生命周期配置，对象遵循 S3 存储桶生命周期或 ILM 策略的保留设置。 
---
= 示例 8：S3 存储桶生命周期和 ILM 策略的优先级
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
根据您的生命周期配置，对象遵循 S3 存储桶生命周期或 ILM 策略的保留设置。



== 存储桶生命周期优先于 ILM 策略的示例

ILM 策略::
+
--
* 基于非当前时间参考的规则：在第 0 天，保留 X 个副本 20 天
* 基于摄取时间参考的规则（默认）：第 0 天，保留 X 个副本 50 天


--
存储桶生命周期:: `"Filter": {"Prefix": "docs/"}, "Expiration": {"Days": 100}, "NoncurrentVersionExpiration": {"NoncurrentDays": 5}`
结果::
+
--
* 一个名为“docs/text”的对象被摄取。它与“docs/”前缀的存储桶生命周期过滤器匹配。
+
** 100 天后，将创建一个删除标记，并且“docs/text”将变为非当前版本。
** 5 天后，即自摄取以来共计 105 天，“docs/text”被删除。
** 95 天后，即自摄取以来总共 200 天，自创建删除标记以来 100 天，过期的删除标记将被删除。


* 一个名为“video/movie”的对象被摄取。它与过滤器不匹配并使用 ILM 保留策略。
+
** 50 天后，将创建一个删除标记，并且“视频/电影”将不再有效。
** 20 天后，即自摄取以来共 70 天，“视频/电影”将被删除。
** 30 天后，即自摄取以来共计 100 天，自创建删除标记以来共计 50 天，过期的删除标记将被删除。




--




== bucket 生命周期隐式永久保存的示例

ILM 策略::
+
--
* 基于非当前时间参考的规则：在第 0 天，保留 X 个副本 20 天
* 基于摄取时间参考的规则（默认）：第 0 天，保留 X 个副本 50 天


--
存储桶生命周期:: `"Filter": {"Prefix": "docs/"}, "Expiration": {"ExpiredObjectDeleteMarker": true}`
结果::
+
--
* 一个名为“docs/text”的对象被摄取。它与“docs/”前缀的存储桶生命周期过滤器匹配。
+
这 `Expiration`操作仅适用于过期的删除标记，这意味着永远保留其他所有内容（以“docs/”开头）。

+
以“docs/”开头的删除标记在过期时会被删除。

* 一个名为“video/movie”的对象被摄取。它与过滤器不匹配并使用 ILM 保留策略。
+
** 50 天后，将创建一个删除标记，并且“视频/电影”将不再有效。
** 20 天后，即自摄取以来共 70 天，“视频/电影”将被删除。
** 30 天后，即自摄取以来共计 100 天，自创建删除标记以来共计 50 天，过期的删除标记将被删除。




--




== 使用存储桶生命周期复制 ILM 并清理过期删除标记的示例

ILM 策略::
+
--
* 基于非当前时间参考的规则：在第 0 天，保留 X 个副本 20 天
* 基于摄取时间参考的规则（默认）：在第 0 天，永久保留 X 个副本


--
存储桶生命周期:: `"Filter": {}, "Expiration": {"ExpiredObjectDeleteMarker": true}, "NoncurrentVersionExpiration": {"NoncurrentDays": 20}`
结果::
+
--
* ILM 策略在存储桶生命周期中重复。
+
** ILM 策略的永久规则旨在手动删除对象并在 20 天后清理非当前版本。因此，摄取时间规则将永远保留过期的删除标记。
** 存储桶生命周期复制 ILM 策略的行为，同时添加 `"ExpiredObjectDeleteMarker": true`，一旦删除标记过期，就会将其删除


* 吞食了物体。无过滤器意味着存储桶生命周期适用于所有对象并覆盖 ILM 保留设置。
+
** 当租户发出对象删除请求时，会创建一个删除标记，并且该对象将变为非当前对象。
** 20 天后，非当前对象将被删除，并且删除标记将过期。
** 不久之后，过期的删除标记就被删除了。




--

