---
permalink: ilm/example-6-changing-ilm-policy.html 
sidebar: sidebar 
keywords: change ILM policy, example ILM policy, information lifecycle policy example 
summary: 如果您的数据保护需要更改或添加新站点，您可以创建并激活新的 ILM 策略。 
---
= 示例 6：更改 ILM 策略
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
如果您的数据保护需要更改或添加新站点，您可以创建并激活新的 ILM 策略。

在更改策略之前，您必须了解 ILM 位置的变化如何暂时影响StorageGRID系统的整体性能。

在此示例中，在扩展中添加了一个新的StorageGRID站点，并且需要实施新的活动 ILM 策略以在新站点存储数据。要实施新的积极政策，首先link:creating-ilm-policy.html["制定政策"]。之后，你必须link:../ilm/creating-ilm-policy.html#simulate-ilm-policy["模拟"]进而link:../ilm/creating-ilm-policy.html#activate-ilm-policy["激活"]新政策。


CAUTION: 以下 ILM 规则和策略仅作为示例。配置 ILM 规则的方法有很多种。在激活新策略之前，请先进行模拟以确认它能够按预期工作以保护内容免遭丢失。



== 更改 ILM 策略如何影响性能

当您激活新的 ILM 策略时， StorageGRID系统的性能可能会暂时受到影响，尤其是当新策略中的放置说明要求将许多现有对象移动到新位置时。

当您激活新的 ILM 策略时， StorageGRID会使用它来管理所有对象，包括现有对象和新摄取的对象。在激活新的 ILM 策略之前，请检查对现有复制和擦除编码对象的位置的任何更改。在评估和实施新位置时，更改现有对象的位置可能会导致临时资源问题。

为了确保新的 ILM 策略不会影响现有复制和纠删码对象的放置，您可以link:create-ilm-rule-enter-details.html#use-advanced-filters-in-ilm-rules["创建带有摄取时间过滤器的 ILM 规则"]。例如，*摄取时间_在_<日期和时间>或之后_*，以便新规则仅适用于在指定日期和时间或之后摄取的对象。

可能暂时影响StorageGRID性能的 ILM 策略更改类型包括：

* 将不同的擦除编码配置文件应用于现有的擦除编码对象。
+

NOTE: StorageGRID认为每个擦除编码配置文件都是唯一的，并且在使用新配置文件时不会重复使用擦除编码片段。

* 更改现有对象所需的副本类型；例如，将大量复制的对象转换为擦除编码对象。
* 将现有对象的副本移动到完全不同的位置；例如，将大量对象移入或移出云存储池或远程站点。




== 主动 ILM 策略示例 6：两个站点的数据保护

在此示例中，活动 ILM 策略最初是为双站点StorageGRID系统设计的，并使用两个 ILM 规则。

image::../media/policy_6_active_policy.png[示例 ILM 策略 6 活动策略]

在此 ILM 策略中，属于租户 A 的对象在单个站点受到 2+1 擦除编码的保护，而属于所有其他租户的对象则在两个站点上使用 2 副本复制进行保护。



=== 规则 1：租户 A 的单站点擦除编码

[cols="1a,2a"]
|===
| 规则定义 | 示例值 


 a| 
规则名称
 a| 
租户 A 的单站点擦除编码



 a| 
租户账户
 a| 
租户A



 a| 
存储池
 a| 
站点 1



 a| 
展示位置
 a| 
站点 1 从第 0 天到永远采用 2+1 擦除编码

|===


=== 规则 2：其他租户的双站点复制

[cols="1a,2a"]
|===
| 规则定义 | 示例值 


 a| 
规则名称
 a| 
其他租户的双站点复制



 a| 
租户账户
 a| 
忽略



 a| 
存储池
 a| 
站点 1 和站点 2



 a| 
展示位置
 a| 
从第 0 天到永远的两个副本：一个副本在站点 1，一个副本在站点 2。

|===


== ILM 策略示例 6：三个站点的数据保护

在此示例中，ILM 策略将被替换为三站点StorageGRID系统的新策略。

在执行扩展以添加新站点后，网格管理员创建了两个新的存储池：一个用于站点 3 的存储池和一个包含所有三个站点的存储池（与所有存储节点默认存储池不同）。然后，管理员创建了两个新的 ILM 规则和一个新的 ILM 策略，旨在保护所有三个站点的数据。

当激活此新的 ILM 策略时，属于租户 A 的对象将在三个站点受到 2+1 擦除编码的保护，而属于其他租户的对象（以及属于租户 A 的较小对象）将使用 3 副本复制在三个站点受到保护。



=== 规则 1：租户 A 的三站点擦除编码

[cols="1a,2a"]
|===
| 规则定义 | 示例值 


 a| 
规则名称
 a| 
租户 A 的三站点擦除编码



 a| 
租户账户
 a| 
租户A



 a| 
存储池
 a| 
所有 3 个站点（包括站点 1、站点 2 和站点 3）



 a| 
展示位置
 a| 
从第 0 天到永远，在所有 3 个站点采用 2+1 擦除编码

|===


=== 规则 2：其他租户的三站点复制

[cols="1a,2a"]
|===
| 规则定义 | 示例值 


 a| 
规则名称
 a| 
其他租户的三站点复制



 a| 
租户账户
 a| 
忽略



 a| 
存储池
 a| 
站点 1、站点 2 和站点 3



 a| 
展示位置
 a| 
从第 0 天到永远的三个副本：站点 1 处一个副本、站点 2 处一个副本、站点 3 处一个副本。

|===


== 激活 ILM 策略示例 6

当您激活新的 ILM 策略时，现有对象可能会被移动到新位置，或者可能会根据任何新规则或更新规则中的放置说明为现有对象创建新的对象副本。


CAUTION: ILM 策略中的错误可能会导致无法恢复的数据丢失。在激活该策略之前，请仔细检查并模拟该策略，以确认其能够按预期发挥作用。


CAUTION: 当您激活新的 ILM 策略时， StorageGRID会使用它来管理所有对象，包括现有对象和新摄取的对象。在激活新的 ILM 策略之前，请检查对现有复制和擦除编码对象的位置的任何更改。在评估和实施新位置时，更改现有对象的位置可能会导致临时资源问题。



=== 当擦除编码指令改变时会发生什么

在此示例的当前活动的 ILM 策略中，属于租户 A 的对象在站点 1 使用 2+1 擦除编码进行保护。在新的 ILM 策略中，属于租户 A 的对象将在站点 1、2 和 3 使用 2+1 擦除编码进行保护。

当新的 ILM 策略被激活时，会发生以下 ILM 操作：

* 租户 A 摄取的新对象被分成两个数据片段，并添加一个奇偶校验片段。然后，将这三个片段分别存储在不同的站点。
* 在正在进行的 ILM 扫描过程中，将重新评估属于租户 A 的现有对象。由于 ILM 放置指令使用了新的擦除编码配置文件，因此会创建全新的擦除编码片段并将其分发到三个站点。
+

NOTE: 站点 1 中现有的 2+1 片段不会被重复使用。  StorageGRID认为每个擦除编码配置文件都是唯一的，并且在使用新配置文件时不会重复使用擦除编码片段。





=== 当复制指令改变时会发生什么

在本例中当前活动的 ILM 策略中，使用站点 1 和 2 的存储池中的两个副本来保护属于其他租户的对象。在新的 ILM 策略中，属于其他租户的对象将使用站点 1、2 和 3 的存储池中的三个副本进行保护。

当新的 ILM 策略被激活时，会发生以下 ILM 操作：

* 当租户 A 以外的任何租户接收新对象时， StorageGRID会创建三个副本并在每个站点保存一份副本。
* 在正在进行的 ILM 扫描过程中，将重新评估属于这些其他租户的现有对象。由于站点 1 和站点 2 上的现有对象副本继续满足新 ILM 规则的复制要求，因此StorageGRID只需要为站点 3 创建该对象的一个​​新副本。




=== 激活此策略对性能的影响

当本例中的 ILM 策略被激活时，该StorageGRID系统的整体性能将受到暂时影响。需要高于正常水平的网格资源来为租户 A 的现有对象创建新的擦除编码片段，并在站点 3 为其他租户的现有对象创建新的复制副本。

由于 ILM 策略的改变，客户端的读写请求可能会暂时遇到高于正常的延迟。当布局指令在整个网格中完全实施后，延迟将恢复到正常水平。

为了避免在激活新的 ILM 策略时出现资源问题，您可以在任何可能更改大量现有对象位置的规则中使用“摄取时间”高级过滤器。将摄取时间设置为大于或等于新策略生效的大致时间，以确保现有对象不会被不必要地移动。


NOTE: 如果您需要在 ILM 策略更改后减慢或加快对象处理的速度，请联系技术支持。
