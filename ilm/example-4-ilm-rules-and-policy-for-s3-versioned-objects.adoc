---
permalink: ilm/example-4-ilm-rules-and-policy-for-s3-versioned-objects.html 
sidebar: sidebar 
keywords: object versions, example ILM rule, information lifecycle rule examples 
summary: 如果您有一个启用了版本控制的 S3 存储桶，则可以通过在 ILM 策略中包含使用非当前时间作为参考时间的规则来管理非当前对象版本。 
---
= 示例 4：S3 版本化对象的 ILM 规则和策略
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
如果您有一个启用了版本控制的 S3 存储桶，则可以通过在 ILM 策略中包含使用“非当前时间”作为参考时间的规则来管理非当前对象版本。


CAUTION: 如果您为对象指定了有限的保留时间，则达到该时间段后这些对象将被永久删除。确保您了解对象将被保留多长时间。

如本例所示，您可以通过对非当前对象版本使用不同的放置指令来控制版本化对象使用的存储量。


CAUTION: 以下 ILM 规则和策略仅作为示例。配置 ILM 规则的方法有很多种。在激活新策略之前，请先进行模拟以确认它能够按预期工作以保护内容免遭丢失。


NOTE: 要对对象的非当前版本执行 ILM 策略模拟，您必须知道对象版本的 UUID 或 CBID。要查找 UUID 和 CBID，请使用link:verifying-ilm-policy-with-object-metadata-lookup.html["对象元数据查找"]当对象仍处于当前状态时。

.相关信息
link:how-objects-are-deleted.html["如何删除对象"]



== ILM 规则 1 例如 4：保存三份副本，保存 10 年

此示例 ILM 规则将每个对象的副本存储在三个站点 10 年。

此规则适用于所有对象，无论它们是否已版本化。

[cols="1a,2a"]
|===
| 规则定义 | 示例值 


 a| 
存储池
 a| 
三个存储池，每个由不同的数据中心组成，分别名为站点 1、站点 2 和站点 3。



 a| 
规则名称
 a| 
十年三份



 a| 
参考时间
 a| 
摄取时间



 a| 
展示位置
 a| 
在第 0 天，保留三个副本 10 年（3,652 天），一个在站点 1，一个在站点 2，一个在站点 3。  10 年后，删除该对象的所有副本。

|===


== ILM 规则 2 例如 4：保存两个非当前版本的副本，保存 2 年

此示例 ILM 规则将存储 S3 版本对象的非当前版本的两个副本，存储期限为 2 年。

由于 ILM 规则 1 适用于对象的所有版本，因此您必须创建另一个规则来过滤掉任何非当前版本。

要创建使用“非当前时间”作为参考时间的规则，请在创建 ILM 规则向导的步骤 1（输入详细信息）中针对“仅将此规则应用于旧对象版本（在启用了版本控制的 S3 存储桶中）？”问题选择*是*。当您选择“是”时，将自动选择“非当前时间”作为参考时间，并且您不能选择其他参考时间。

image::../media/ilm-rule-apply-only-to-older-object-verions.png[仅将 ILM 规则应用于较旧的对象版本（非当前时间）]

在此示例中，仅存储了非当前版本的两个副本，并且这些副本将存储两年。

[cols="1a,2a"]
|===
| 规则定义 | 示例值 


 a| 
存储池
 a| 
两个存储池，分别位于不同的数据中心：站点 1 和站点 2。



 a| 
规则名称
 a| 
非现行版本：两年两份



 a| 
参考时间
 a| 
非当前时间

在创建 ILM 规则向导中，对于“仅将此规则应用于旧对象版本（在启用了版本控制的 S3 存储桶中）？”的问题选择“是”时，会自动选择。



 a| 
展示位置
 a| 
在相对于非当前时间的第 0 天（即从对象版本成为非当前版本的那天开始），将非当前对象版本的两个副本保留 2 年（730 天），一个在站点 1，一个在站点 2。两年后，删除非当前版本。

|===


== ILM 策略示例 4：S3 版本化对象

如果您想要以不同于当前版本的方式管理对象的旧版本，则使用“非当前时间”作为参考时间的规则必须出现在 ILM 策略中，并且出现在适用于当前对象版本的规则之前。

S3 版本化对象的 ILM 策略可能包括如下 ILM 规则：

* 从版本变为非当前版本之日起，将每个对象的任何旧版本（非当前版本）保留 2 年。
+

NOTE: “非当前时间”规则必须出现在策略中适用于当前对象版本的规则之前。否则，非当前对象版本将永远不会符合“非当前时间”规则。

* 在摄取时，创建三个副本并在三个站点各存储一份。保留当前对象版本的副本 10 年。


当您模拟示例策略时，您会期望测试对象按如下方式进行评估：

* 任何非当前对象版本都将与第一条规则匹配。如果非当前对象版本超过 2 年，它将被 ILM 永久删除（非当前版本的所有副本都将从网格中删除）。
* 当前对象版本将与第二条规则匹配。当当前对象版本已存储 10 年后，ILM 流程会添加一个删除标记作为对象的当前版本，并使之前的对象版本变为“非当前”版本。下次进行 ILM 评估时，此非当前版本将与第一条规则匹配。因此，站点 3 的副本被清除，站点 1 和站点 2 的两个副本将再保存 2 年。

