---
permalink: ilm/creating-ilm-policy.html 
sidebar: sidebar 
keywords: how to create ILM policy 
summary: 创建一个或多个 ILM 策略以满足您的服务质量要求。 
---
= 创建 ILM 策略
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
创建一个或多个 ILM 策略以满足您的服务质量要求。

拥有一个活动的 ILM 策略允许您将相同的 ILM 规则应用于所有租户和存储桶。

拥有多个活动的 ILM 策略允许您将适当的 ILM 规则应用于特定的租户和存储桶，以满足多种服务质量要求。



== 创建 ILM 策略

.关于此任务
在创建您自己的策略之前，请验证link:ilm-policy-overview.html#default-ilm-policy["默认 ILM 策略"]不符合您的存储要求。


NOTE: 在测试系统中，仅使用系统提供的策略，即 2 个副本策略（适用于单站点网格）或每个站点 1 个副本（适用于多站点网格）。对于StorageGRID 11.6 及更早版本，此策略中的默认规则使用包含所有站点的所有存储节点存储池。如果您的StorageGRID系统有多个站点，则对象的两个副本可能会放置在同一个站点上。


NOTE: 如果link:enabling-s3-object-lock-globally.html["全局 S3 对象锁定设置已启用"]，您必须确保 ILM 策略符合启用了 S3 对象锁定的存储桶的要求。在本节中，请按照提及启用 S3 对象锁的说明进行操作。

.开始之前
* 您已使用link:../admin/web-browser-requirements.html["支持的网络浏览器"]。
* 你有link:../admin/admin-group-permissions.html["所需的访问权限"]。
* 你有link:access-create-ilm-rule-wizard.html["创建 ILM 规则"]根据是否启用 S3 对象锁。
+
[role="tabbed-block"]
====
.S3 对象锁未启用
--
** 你有link:what-ilm-rule-is.html["创建 ILM 规则"]您想要添加到策略中。根据需要，您可以保存策略、创建其他规则，然后编辑策略以添加新规则。
** 你有link:creating-default-ilm-rule.html["创建了默认的 ILM 规则"]不包含任何过滤器。


--
.已启用 S3 对象锁定
--
** 这link:enabling-s3-object-lock-globally.html["全局 S3 对象锁定设置已启用"]用于StorageGRID系统。
** 你有link:what-ilm-rule-is.html["创建合规和不合规的 ILM 规则"]您想要添加到策略中。根据需要，您可以保存策略、创建其他规则，然后编辑策略以添加新规则。
** 你有link:creating-default-ilm-rule.html["创建了默认的 ILM 规则"]符合政策。


--
====
* 或者，您已经观看了视频： https://netapp.hosted.panopto.com/Panopto/Pages/Viewer.aspx?id=e768d4da-da88-413c-bbaa-b1ff00874d10["视频：ILM 政策概述"^]
+
[link=https://netapp.hosted.panopto.com/Panopto/Pages/Viewer.aspx?id=e768d4da-da88-413c-bbaa-b1ff00874d10]
image::../media/video-screenshot-ilm-policies-118.png[视频：ILM 政策概述]



另请参阅link:ilm-policy-overview.html["使用 ILM 策略"] 。

.步骤
. 选择 *ILM* > *策略*。
+
如果启用了全局 S3 对象锁定设置，则 ILM 策略页面会指示哪些 ILM 规则是合规的。

. 确定您想要如何创建 ILM 策略。
+
[role="tabbed-block"]
====
.创建新策略
--
.. 选择*创建策略*。


--
.克隆现有策略
--
.. 选中您想要开始的策略的复选框，然后选择*克隆*。


--
.编辑现有政策
.. 如果策略处于非活动状态，您可以对其进行编辑。选中您想要开始的非活动策略的复选框，然后选择*编辑*。


====


. 在“策略名称”字段中，输入策略的唯一名称。
. 或者，在*变更原因*字段中，输入创建新策略的原因。
. 要向策略添加规则，请选择“选择规则”。选择规则名称以查看该规则的设置。
+
--
如果您正在克隆策略：

** 您正在克隆的策略所使用的规则已被选中。
** 如果您克隆的策略使用了任何不带过滤器的非默认规则的规则，系统将提示您删除除其中一条规则之外的所有规则。
** 如果默认规则使用了过滤器，系统会提示您选择新的默认规则。
** 如果默认规则不是最后一条规则，您可以将该规则移动到新策略的末尾。


--
+
[role="tabbed-block"]
====
.S3 对象锁未启用
--
.. 为策略选择一个默认规则。要创建新的默认规则，请选择*ILM 规则页面*。
+
默认规则适用于与策略中其他规则不匹配的任何对象。默认规则不能使用任何过滤器，并且始终最后进行评估。

+

NOTE: 不要将“制作 2 份副本”规则用作策略的默认规则。 Make 2 Copies 规则使用单个存储池，即包含所有站点的所有存储节点。如果您的StorageGRID系统有多个站点，则对象的两个副本可能会放置在同一个站点上。



--
.已启用 S3 对象锁定
--
.. 为策略选择一个默认规则。要创建新的默认规则，请选择*ILM 规则页面*。
+
规则列表仅包含符合要求且不使用任何过滤器的规则。

+

NOTE: 不要将“制作 2 份副本”规则用作策略的默认规则。 Make 2 Copies 规则使用单个存储池，即包含所有站点的所有存储节点。如果使用此规则，则对象的多个副本可能会放置在同一个站点上。

.. 如果您需要针对不合规 S3 存储桶中的对象使用不同的“默认”规则，请选择*包含不合规 S3 存储桶的无过滤器规则*，然后选择一个不使用过滤器的不合规规则。
+
例如，您可能希望使用云存储池将对象存储在未启用 S3 对象锁的存储桶中。

+

NOTE: 您只能选择一个不使用过滤器的不合规规则。



另请参阅link:example-7-compliant-ilm-policy-for-s3-object-lock.html["示例 7：符合 S3 对象锁定的 ILM 策略"] 。

--
====


. 选择完默认规则后，选择“继续”。
. 对于其他规则步骤，选择要添加到策略的任何其他规则。这些规则至少使用一个过滤器（租户帐户、存储桶名称、高级过滤器或非当前参考时间）。然后选择*选择*。
+
现在，“创建策略”窗口列出了您选择的规则。默认规则位于最后，其他规则位于其上方。

+
如果启用了 S3 对象锁定并且您还选择了不合规的“默认”规则，则该规则将作为策略中的倒数第二条规则添加。

+

NOTE: 如果任何规则没有永久保留对象，则会出现警告。激活此策略时，您必须确认希望StorageGRID在默认规则的放置指令过期时删除对象（除非存储桶生命周期将对象保留更长时间）。

. 拖动非默认规则的行来确定这些规则的评估顺序。
+
您无法移动默认规则。如果启用了 S3 对象锁定，您也无法移动不合规的“默认”规则（如果选择了该规则）。

+

NOTE: 您必须确认 ILM 规则的顺序正确。当策略被激活时，新的和现有的对象将按照列出的顺序从顶部开始由规则进行评估。

. 根据需要，选择*选择规则*来添加或删除规则。
. 完成后，选择*保存*。
. 重复这些步骤来创建其他 ILM 策略。
. <<simulate-ilm-policy,模拟 ILM 策略>> 。您应该始终在激活策略之前对其进行模拟，以确保其按预期工作。




== 模拟策略

在激活策略并将其应用于生产数据之前，先在测试对象上模拟该策略。

.开始之前
* 您知道要测试的每个对象的 S3 存储桶/对象键。


.步骤
. 使用 S3 客户端或link:../tenant/use-s3-console.html["S3 控制台"]，摄取测试每条规则所需的对象。
. 在 ILM 策略页面上，选中该策略的复选框，然后选择*模拟*。
. 在“对象”字段中，输入 S3 `bucket/object-key`用于测试对象。例如，  `bucket-01/filename.png` 。
. 如果启用了 S3 版本控制，则可以选择在 *版本 ID* 字段中输入对象的版本 ID。
. 选择*模拟*。
. 在模拟结果部分，确认每个对象都符合正确的规则。
. 要确定哪个存储池或擦除编码配置文件有效，请选择匹配规则的名称以转到规则详细信息页面。



CAUTION: 审查现有复制和擦除编码对象的位置的任何更改。在评估和实施新位置时，更改现有对象的位置可能会导致临时资源问题。

.结果
对策略规则的任何编辑都将反映在模拟结果中，并显示新的匹配和之前的匹配。模拟策略窗口将保留您测试的对象，直到您选择“全部清除”或“删除”图标image:../media/icon-x-to-remove.png["删除图标"]对于模拟结果列表中的每个对象。

.相关信息
link:simulating-ilm-policy-examples.html["ILM 策略模拟示例"]



== 激活策略

当您激活单个新的 ILM 策略时，现有对象和新摄取的对象都由该策略管理。当您激活多个策略时，分配给存储桶的 ILM 策略标签决定了要管理的对象。

激活新策略之前：

. 模拟该策略以确认其行为符合您的预期。
. 审查现有复制和擦除编码对象的位置的任何更改。在评估和实施新位置时，更改现有对象的位置可能会导致临时资源问题。



CAUTION: ILM 策略中的错误可能会导致无法恢复的数据丢失。

.关于此任务
当您激活 ILM 策略时，系统会将新策略分发到所有节点。但是，直到所有网格节点都可以接收新策略时，新的活动策略才可能真正生效。在某些情况下，系统会等待实施新的活动策略，以确保网格对象不会被意外删除。具体来说：

* 如果您做出的策略更改*增加了数据冗余或持久性*，则这些更改将立即实施。例如，如果您激活包含三份副本规则而不是两份副本规则的新策略，则该策略将立即实施，因为它增加了数据冗余。
* 如果您做出的策略更改*可能会降低数据冗余度或持久性*，则这些更改将不会实施，直到所有网格节点都可用。例如，如果您激活使用两份规则而不是三份规则的新策略，则新策略将出现在“活动策略”选项卡中，但直到所有节点都联机且可用时才会生效。


.步骤
按照以下步骤激活一个或多个策略：

[role="tabbed-block"]
====
.激活一项策略
--
如果您只有一项有效政策，请按照以下步骤操作。如果您已经拥有一个或多个有效策略，并且要激活其他策略，请按照激活多个策略的步骤操作。

. 当您准备好激活策略时，选择 *ILM* > *Policies*。
+
或者，您可以从 *ILM* > *策略标签* 页面激活单个策略。

. 在“策略”选项卡上，选中要激活的策略的复选框，然后选择“*激活*”。
. 按照适当的步骤操作：
+
** 如果警告消息提示您确认是否要激活该策略，请选择“*确定*”。
** 如果出现包含有关该策略的详细信息的警告消息：
+
... 检查详细信息以确保策略能够按预期管理数据。
... 如果默认规则存储对象的天数有限，请查看保留图，然后在文本框中输入该天数。
... 如果默认规则永久存储对象，但一个或多个其他规则具有有限的保留，请在文本框中输入 *yes*。
... 选择*激活策略*。






--
.激活多项策略
--
要激活多个策略，您必须创建标签并为每个标签分配一个策略。


TIP: 当使用多个标签时，如果租户频繁地将策略标签重新分配给存储桶，则网格性能可能会受到影响。如果您有不受信任的租户，请考虑仅使用默认标签。

. 选择 *ILM* > *策略标签*。
. 选择“*创建*”。
. 在创建策略标签对话框中，键入标签名称，并可选地键入标签描述。
+

NOTE: 标签名称和描述对租户可见。选择能够帮助租户在选择分配给其存储桶的策略标签时做出明智决定的值。例如，如果分配的策略将在一段时间后删除对象，您可以在描述中传达这一点。不要在这些字段中包含敏感信息。

. 选择*创建标签*。
. 在 ILM 策略标签表中，使用下拉菜单选择要分配给标签的策略。
. 如果“政策限制”列中出现警告，请选择“查看政策详情”以查看该政策。
. 确保每项策略都能按预期管理数据。
. 选择*激活分配的策略*。或者，选择“*清除更改*”以删除策略分配。
. 在使用新标签激活策略对话框中，查看每个标签、策略和规则如何管理对象的描述。根据需要进行更改以确保策略能够按预期管理对象。
. 当您确定要激活策略时，在文本框中输入*yes*，然后选择*Activate policies*。


--
====
.相关信息
link:example-6-changing-ilm-policy.html["示例 6：更改 ILM 策略"]
