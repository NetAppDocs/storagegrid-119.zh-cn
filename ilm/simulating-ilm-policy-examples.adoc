---
permalink: ilm/simulating-ilm-policy-examples.html 
sidebar: sidebar 
keywords: simulate ilm policy 
summary: ILM 策略模拟的示例为您构建和修改环境模拟提供了指导。 
---
= ILM 策略模拟示例
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ILM 策略模拟的示例为您构建和修改环境模拟提供了指导。



== 示例 1：模拟 ILM 策略时验证规则

本示例介绍如何在模拟策略时验证规则。

在此示例中，*示例 ILM 策略*针对两个存储桶中摄取的对象进行模拟。该政策包含三条规则，具体如下：

* 第一条规则“*存储桶 a 的两份副本，两年*”仅适用于存储桶 a 中的对象。
* 第二条规则 *EC 对象 > 1 MB* 适用于所有存储桶，但会过滤大于 1 MB 的对象。
* 第三条规则“两个副本，两个数据中心”是默认规则。它不包含任何过滤器并且不使用非当前参考时间。


模拟策略后，确认每个对象都与正确的规则匹配。

image::../media/simulate_policy_screen.png[模拟政策结果]

在此示例中：

* `bucket-a/bucket-a object.pdf`正确匹配了第一条规则，该规则过滤了 `bucket-a`。
* `bucket-b/test object greater than 1 MB.pdf`位于 `bucket-b`，因此它不符合第一条规则。相反，它与第二条规则正确匹配，该规则过滤大于 1 MB 的对象。
* `bucket-b/test object less than 1 MB.pdf`与前两个规则中的过滤器不匹配，因此它将被放置在不包含任何过滤器的默认规则中。




== 示例 2：模拟 ILM 策略时重新排序规则

此示例展示了如何在模拟策略时重新排序规则以更改结果。

在此示例中，正在模拟*Demo*策略。该策略旨在查找具有 series=x-men 用户元数据的对象，包含以下三条规则：

* 第一条规则 *PNGs* 过滤以以下结尾的键名 `.png`。
* 第二条规则 *X-men* 仅适用于租户 A 的对象和 `series=x-men`用户元数据。
* 最后一条规则“两个数据中心的两个副本”是默认规则，它匹配任何与前两条规则不匹配的对象。


.步骤
. 添加规则并保存策略后，选择*模拟*。
. 在*对象*字段中，输入测试对象的 S3 存储桶/对象键并选择*模拟*。
+
模拟结果显示 `Havok.png`对象与 *PNGs* 规则匹配。

+
image::../media/simulate_reorder_rules_pngs_result.png[示例 2：模拟 ILM 策略时重新排序规则]

+
然而， `Havok.png`是为了测试*X-men*规则。

. 要解决此问题，请重新排序规则。
+
.. 选择“*完成*”关闭“模拟 ILM 策略”窗口。
.. 选择“*编辑*”来编辑该策略。
.. 将 *X-men* 规则拖到列表顶部。
.. 选择*保存*。


. 选择*模拟*。
+
您之前测试的对象将根据更新后的策略重新评估，并显示新的模拟结果。在示例中，规则匹配列显示 `Havok.png`正如预期的那样，对象现在与 X-men 元数据规则匹配。上一个匹配列显示 PNG 规则与上一个模拟中的对象匹配。

+
image::../media/simulate_reorder_rules_correct_result.png[示例 2：模拟 ILM 策略时重新排序规则]





== 示例 3：模拟 ILM 策略时更正规则

此示例显示如何模拟策略、更正策略中的规则并继续模拟。

在此示例中，正在模拟*Demo*策略。此策略旨在查找具有 `series=x-men`用户元数据。然而，在模拟这一政策时出现了意想不到的结果 `Beast.jpg`目的。该对象没有匹配 X-men 元数据规则，而是匹配了默认规则“两个副本两个数据中心”。

image::../media/simulate_results_for_object_wrong_metadata.png[示例 3：模拟 ILM 策略时更正规则]

当测试对象与策略中的预期规则不匹配时，您必须检查策略中的每个规则并纠正任何错误。

.步骤
. 选择“*完成*”关闭“模拟策略”对话框。在政策的详细信息页面上，选择*保留图*。然后根据需要为每条规则选择*全部展开*或*查看详细信息*。
. 查看规则的租户帐户、参考时间和过滤条件。
+
例如，假设 X-men 规则的元数据输入为“x-men01”而不是“x-men”。

. 要解决该错误，请按如下方式更正规则：
+
** 如果该规则是策略的一部分，您可以克隆该规则或从策略中删除该规则，然后对其进行编辑。
** 如果该规则是活动策略的一部分，则必须克隆该规则。您不能编辑或删除活动策略中的规则。


. 再次执行模拟。
+
在这个例子中，修正后的 X-men 规则现在与 `Beast.jpg`对象基于 `series=x-men`用户元数据，正如预期的那样。

+
image::../media/simulate_results_for_object_corrected_metadata.png[示例 3：模拟 ILM 策略时更正规则]


