---
permalink: tenant/grid-federation-manage-cross-grid-replication.html 
sidebar: sidebar 
keywords: grid federation, cross-grid replication, use grid federation connection, replicate client delete markers, s3 bucket 
summary: 如果您的租户帐户在创建时被分配了使用网格联合连接权限，则可以使用跨网格复制在租户源网格上的存储桶和租户目标网格上的存储桶之间自动复制对象。跨网格复制可以单向或双向进行。 
---
= 管理跨网格复制
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
如果您的租户帐户在创建时被分配了 *使用网格联合连接* 权限，则您可以使用跨网格复制在租户源网格上的存储桶和租户目标网格上的存储桶之间自动复制对象。跨网格复制可以单向或双向进行。



== 跨网格复制的工作流程

工作流程图总结了配置两个网格上的存储桶之间的跨网格复制所要执行的步骤。下面将更详细地描述这些步骤。

image::../media/grid-federation-cgr-workflow.png[跨网格复制工作流程]



== 配置跨网格复制

在使用跨网格复制之前，您必须登录到每个网格上相应的租户帐户并创建相同的存储桶。然后，您可以在一个或两个存储桶上启用跨网格复制。

.开始之前
* 您已查看了跨网格复制的要求。看link:../admin/grid-federation-what-is-cross-grid-replication.html["什么是跨网格复制"] 。
* 您正在使用link:../admin/web-browser-requirements.html["支持的网络浏览器"]。
* 租户帐户具有*使用网格联合连接*权限，并且两个网格上都存在相同的租户帐户。看link:../admin/grid-federation-manage-tenants.html["管理允许的电网联合连接租户"] 。
* 您将以该身份登录的租户用户已存在于两个网格中，并且属于具有link:tenant-management-permissions.html["Root访问权限"]。
* 如果您将以本地用户身份登录到租户的目标网格，则租户帐户的根用户已为您在该网格上的用户帐户设置了密码。




=== 创建两个相同的存储桶

第一步，登录每个网格上相应的租户帐户并创建相同的存储桶。

.步骤
. 从网格联合连接中的任一网格开始，创建一个新的存储桶：
+
.. 使用两个网格上都存在的租户用户的凭据Sign in租户帐户。
+

NOTE: 如果您无法以本地用户身份登录租户的目标网格，请确认租户帐户的根用户已为您的用户帐户设置密码。

.. 按照说明link:creating-s3-bucket.html["创建一个 S3 存储桶"]。
.. 在*管理对象设置*选项卡上，选择*启用对象版本控制*。
.. 如果您的StorageGRID系统启用了 S3 对象锁，请不要为存储桶启用 S3 对象锁。
.. 选择*创建存储桶*。
.. 选择*完成*。


. 重复这些步骤，为网格联合连接中的另一个网格上的同一租户帐户创建相同的存储桶。
+

TIP: 根据需要，每个存储桶可以使用不同的区域。





=== 启用跨网格复制

在将任何对象添加到任一存储桶之前，您必须执行这些步骤。

.步骤
. 从要复制对象的网格开始，启用link:../admin/grid-federation-what-is-cross-grid-replication.html["单向跨网格复制"]：
+
.. Sign in存储桶的租户帐户。
.. 从仪表板中选择 *查看存储桶*，或选择 *存储（S3）* > *存储桶*。
.. 从表中选择存储桶名称以访问存储桶详细信息页面。
.. 选择*跨网格复制*选项卡。
.. 选择*启用*，并查看要求列表。
.. 如果所有要求都已满足，请选择要使用的电网联合连接。
.. 或者，更改 *复制删除标记* 的设置，以确定当 S3 客户端向源网格发出不包含版本 ID 的删除请求时目标网格上会发生什么：
+
*** *是*（默认）：将删除标记添加到源存储桶并复制到目标存储桶。
*** *否*：删除标记已添加到源存储桶，但未复制到目标存储桶。
+
image::../media/grid-federation-cross-grid-replication-client-deletes.png[该图显示了两个网格上的复制客户端删除]

+

NOTE: 如果删除请求包含版本 ID，则该对象版本将从源存储桶中永久删除。StorageGRID不会复制包含版本 ID 的删除请求，因此不会从目标中删除相同的对象版本。

+
看link:../admin/grid-federation-what-is-cross-grid-replication.html["什么是跨网格复制"]了解详情。



.. 或者，更改“跨网格复制”审计类别的设置来管理审计消息的数量：
+
*** *错误*（默认）：审计输出中仅包含失败的跨网格复制请求。
*** *正常*：包括所有跨网格复制请求，这显著增加了审计输出量。


.. 检查您的选择。除非两个存储桶都为空，否则您无法更改这些设置。
.. 选择*启用并测试*。
+
片刻之后，会出现一条成功消息。添加到此存储桶的对象现在将自动复制到另一个网格。*跨网格复制*在存储桶详细信息页面上显示为已启用的功能。



. 或者，转到另一个网格上的相应存储桶，然后link:../admin/grid-federation-what-is-cross-grid-replication.html["启用双向跨网格复制"]。




== 测试网格之间的复制

如果为存储桶启用了跨网格复制，您可能需要验证连接和跨网格复制是否正常工作，以及源存储桶和目标存储桶是否仍然满足所有要求（例如，版本控制仍然启用）。

.开始之前
* 您正在使用link:../admin/web-browser-requirements.html["支持的网络浏览器"]。
* 您属于具有link:tenant-management-permissions.html["Root访问权限"]。


.步骤
. Sign in存储桶的租户帐户。
. 从仪表板中选择 *查看存储桶*，或选择 *存储（S3）* > *存储桶*。
. 从表中选择存储桶名称以访问存储桶详细信息页面。
. 选择*跨网格复制*选项卡。
. 选择*测试连接*。
+
如果连接正常，则会出现成功横幅。否则，会出现一条错误消息，您和网格管理员可以使用它来解决问题。有关详细信息，请参阅link:../admin/grid-federation-troubleshoot.html["解决网格联合错误"] 。

. 如果跨网格复制配置为双向进行，请转到另一个网格上的相应存储桶并选择*测试连接*以验证跨网格复制是否在另一个方向上有效。




== 禁用跨网格复制

如果您不再想将对象复制到另一个网格，您可以永久停止跨网格复制。

在禁用跨网格复制之前，请注意以下事项：

* 禁用跨网格复制不会删除任何已在网格之间复制的对象。例如， `my-bucket`网格 1 上已复制到 `my-bucket`如果您禁用该存储桶的跨网格复制，则网格 2 上的数据不会被删除。如果要删除这些对象，则必须手动将其删除。
* 如果每个存储桶都启用了跨网格复制（即，如果复制在两个方向上发生），则可以禁用一个或两个存储桶的跨网格复制。例如，您可能想要禁用从 `my-bucket`在网格 1 上 `my-bucket`在网格 2 上，同时继续从 `my-bucket`在网格 2 上 `my-bucket`在网格 1 上。
* 您必须先禁用跨网格复制，然后才能删除租户使用网格联合连接的权限。看link:../admin/grid-federation-manage-tenants.html["管理获准租户"] 。
* 如果您禁用包含对象的存储桶的跨网格复制，则除非您从源存储桶和目标存储桶中删除所有对象，否则将无法重新启用跨网格复制。
+

CAUTION: 除非两个存储桶都为空，否则您无法重新启用复制。



.开始之前
* 您正在使用link:../admin/web-browser-requirements.html["支持的网络浏览器"]。
* 您属于具有link:tenant-management-permissions.html["Root访问权限"]。


.步骤
. 从不再需要复制其对象的网格开始，停止存储桶的跨网格复制：
+
.. Sign in存储桶的租户帐户。
.. 从仪表板中选择 *查看存储桶*，或选择 *存储（S3）* > *存储桶*。
.. 从表中选择存储桶名称以访问存储桶详细信息页面。
.. 选择*跨网格复制*选项卡。
.. 选择*禁用复制*。
.. 如果您确定要禁用此存储桶的跨网格复制，请在文本框中输入*是*，然后选择*禁用*。
+
片刻之后，会出现一条成功消息。添加到此存储桶的新对象无法再自动复制到其他网格。  *跨网格复制*不再在 Buckets 页面上显示为已启用的功能。



. 如果跨网格复制配置为双向进行，请转到另一个网格上的相应存储桶并停止另一个方向的跨网格复制。

