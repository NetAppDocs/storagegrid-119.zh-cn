---
permalink: primer/delete-data-flow.html 
sidebar: sidebar 
keywords: object, delete, deletion, object lock, bucket lifecycle, expiration, ilm, placement instruction 
summary: 当客户端或租户执行删除操作或对象的生命周期到期时，所有对象副本都会从StorageGRID系统中删除，从而触发其自动删除。有一个定义的对象删除数据流。 
---
= 删除数据流
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
当客户端执行删除操作或对象的生命周期到期时，所有对象副本都会从StorageGRID系统中删除，从而触发其自动删除。有一个定义的对象删除数据流。



== 删除层次结构

StorageGRID提供了几种控制何时保留或删除对象的方法。对象可以根据客户端请求或自动删除。  StorageGRID始终优先处理任何 S3 对象锁定设置，而不是客户端删除请求，而客户端删除请求又优先于 S3 存储桶生命周期和 ILM 放置指令。

* *S3 对象锁定*：如果为网格启用了全局 S3 对象锁定设置，S3 客户端可以创建启用了 S3 对象锁定的存储桶，然后使用 S3 REST API 为添加到该存储桶的每个对象版本指定保留截止日期和合法保留设置。
+
** 处于合法保留状态的对象版本无法通过任何方法删除。
** 在达到对象版本的保留截止日期之前，无法通过任何方法删除该版本。
** 启用 S3 对象锁的存储桶中的对象将被 ILM“永久”保留。但是，在达到保留期限后，对象版本可能会因客户端请求或存储桶生命周期到期而被删除。
** 如果 S3 客户端对存储桶应用默认保留截止日期，则它们不需要为每个对象指定保留截止日期。


* *客户端删除请求*：S3 客户端可以发出删除对象请求。当客户端删除一个对象时，该对象的所有副本都将从StorageGRID系统中删除。
* *删除存储桶中的对象*：租户管理器用户可以使用此选项从StorageGRID系统永久删除选定存储桶中对象和对象版本的所有副本。
* *S3 存储桶生命周期*：S3 客户端可以向其存储桶添加指定到期操作的生命周期配置。如果存在存储桶生命周期，则当满足到期操作中指定的日期或天数时， StorageGRID会自动删除对象的所有副本，除非客户端先删除该对象。
* *ILM 放置说明*：假设存储桶未启用 S3 对象锁定并且没有存储桶生命周期，则当 ILM 规则中的最后一个时间段结束并且没有为该对象指定进一步的放置时， StorageGRID会自动删除该对象。
+

NOTE: 配置 S3 存储桶生命周期后，生命周期到期操作将覆盖与生命周期过滤器匹配的对象的 ILM 策略。因此，即使放置对象的任何 ILM 指令已经失效，对象仍可能保留在网格上。



看link:../ilm/how-objects-are-deleted.html["如何删除对象"]了解更多信息。



== 客户端删除的数据流

image::../media/delete_data_flow.png[客户端删除数据流]

. LDR 服务从客户端应用程序接收删除请求。
. LDR 服务更新元数据存储，以便对象在客户端请求中看起来已被删除，并指示 ILM 引擎删除对象数据的所有副本。
. 该对象已从系统中删除。元数据存储已更新以删除对象元数据。




== ILM 删除的数据流

image::../media/automatic_deletion_data_flow.png[自动删除数据流]

. ILM引擎确定该对象需要被删除。
. ILM 引擎通知元数据存储。元数据存储更新对象元数据，以便对象在客户端请求中看起来已被删除。
. ILM 引擎删除该对象的所有副本。元数据存储已更新以删除对象元数据。

